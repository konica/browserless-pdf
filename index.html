<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>F2 Integration</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol@v10.6.0/ol.css"
    />
  </head>
  <body>
    <div id="app">
      <div class="map-container">
        <div ref="mapContainer" id="map"></div>
      </div>
      <div class="info-section">
        <div class="general-info">
          <h2>Project information</h2>
          <div class="project-details">
            <div class="info-item">
              <strong>Name:</strong> 游봇 MST - DDH - Delete - 1
            </div>
            <div class="info-item"><strong>Description:</strong> N/A</div>
            <div class="info-item"><strong>Version:</strong> 1</div>
            <div class="info-item"><strong>Created:</strong> 2023-01-01</div>
            <div class="info-item"><strong>Updated:</strong> 2023-01-02</div>
            <div class="info-item">
              <strong>Last state changed:</strong> 2023-01-03
            </div>
            <div class="info-item">
              <strong>Link to Project:</strong>
              <a
                href="https://mars.udv.sgav.dk/projects/402a966e-6d9f-41ff-9bda-23cc55ba5d76"
                target="_blank"
                class="project-link"
                >https://mars.udv.sgav.dk/projects/402a966e-6d9f-41ff-9bda-23cc55ba5d76
              </a>
            </div>
            <div class="info-item">
              <strong>Creator:</strong> USa_MST_ MARS_Planl칝gger (Milj칮styrelsen - DK25798376)
            </div>
            <div class="info-item">
              <strong>Owner:</strong> Milj칮styrelsen (DK25798376)
            </div>
          </div>

          <h2>Subsidy scheme</h2>
          <div class="subsidy-details">
            <div class="info-item">
              <strong>Name:</strong> Kv칝lstofv친domr친der
            </div>
            <div class="info-item">
              <strong>Description:</strong> Du kan s칮ge tilskud til at lave et
              kv칝lstofv친domr친de under Styrelsen for Gr칮n Arealoml칝gning og
              Vandmilj칮s ordning til Vand- og Klimaprojekter. Et
              kv칝lstofv친domr친de har til form친l at genskabe naturlige
              vandforhold, s친 udledningen af kv칝lstof til vores kystvande,
              fjorde og s칮er mindskes. Kv칝lstofv친domr친deordningen kan s칮ges af
              kommuner og Naturstyrelsen, som gennemf칮rer projekterne gennem
              frivillige aftaler med lodsejere.
            </div>
            <div class="info-item"><strong>Organization:</strong> SGAV</div>
            <div class="info-item"><strong>Owner VAT:</strong> DK20814616</div>
            <div class="info-item"><strong>Active:</strong> Yes</div>
            <div class="info-item">
              <strong>URL:</strong>
              <a
                href="https://sgavmst.dk/tilskud/tilskud-til-vand-og-klimaprojekter/kvaelstof-og-fosforvaadomraader"
                target="_blank"
                class="project-link"
                >https://sgavmst.dk/tilskud/tilskud-til-vand-og-klimaprojekter/kvaelstof-og-fosforvaadomraader
              </a>
            </div>
            <div class="info-item">
              <strong>Mitigation measure:</strong> Kv칝lstofv친domr친der
            </div>
          </div>

          <h2>Project Effects</h2>
          <div class="effects-details">
            <div class="info-item">
              <strong>Nitrogen reduction:</strong> 0.971 tons
            </div>
            <div class="info-item">
              <strong>Extraction effort:</strong> 27.58 ha
            </div>
            <div class="info-item">
              <strong>Afforestation effort:</strong> 0.25 ha
            </div>
          </div>

          <h2>Forest</h2>
          <div class="forest-details">
            <table class="forest-table">
              <thead>
                <tr>
                  <th>BFE nummer</th>
                  <th>Matrikelnummer</th>
                  <th>Areal</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>9065681</td>
                  <td>1a</td>
                  <td>0,2 ha</td>
                </tr>
                <tr>
                  <td>9065681</td>
                  <td>1o</td>
                  <td>1 ha</td>
                </tr>
                <tr>
                  <td>9065681</td>
                  <td>1p</td>
                  <td>0,6 ha</td>
                </tr>
                <tr>
                  <td>9065682</td>
                  <td>1b</td>
                  <td>0,2 ha</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h2>Untouched forest</h2>
          <div class="untouched-forest-details">
            <table class="forest-table">
              <thead>
                <tr>
                  <th>BFE nummer</th>
                  <th>Matrikelnummer</th>
                  <th>Areal</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>9065681</td>
                  <td>1a</td>
                  <td>0,2 ha</td>
                </tr>
                <tr>
                  <td>9065681</td>
                  <td>1o</td>
                  <td>1 ha</td>
                </tr>
                <tr>
                  <td>9065681</td>
                  <td>1p</td>
                  <td>0,6 ha</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/ol@v10.6.0/dist/ol.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/proj4@2.8.0/dist/proj4.js"></script>
    <script>
      // Declare the project variable
      const project = {
        id: "f0f66d36-8fc1-493a-8324-c705e2e203fe",
        name: "\uD83E\uDD75 MST - DDH - Delete - 1",
        description: null,
        caseId: null,
        stateNr: 9,
        geoLocationId: "a3254cce-0d68-4744-bf23-4514d2ccd453",
        subsidyScheme: {
          id: "9df33a22-2ec7-47fb-b5ad-5c45e2a06979",
          name: "Lavbundsprojekter",
          organization: "SGAV",
          ownerVat: "DK20814616",
          flowNr: 1,
          mitigationMeasureId: "4d1bdb7a-ee68-46c1-9364-792ad26eb337",
          description:
            "Du kan s칮ge tilskud til lavbundsprojekter hos Styrelsen for Gr칮n Arealoml칝gning og Vandmilj칮s ordning Vand- og Klimaprojekter. Form친let med tilskudsordningen er at reducere drivhusgasudledning, fjerne kv칝lstof og til forbedring af natur. Tilskudsordningen kan s칮ges af kommuner og Naturstyrelsen.",
          url: "https://sgavmst.dk/tilskud/tilskud-til-vand-og-klimaprojekter/lavbundsprojekter",
          icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_3765_33112)"><path d="M1.7178 9.459C1.49623 9.63025 1.34584 9.88117 1.24022 10.1654C1.01712 10.7666 1.00908 11.3723 1.22797 11.9768C1.329 12.2557 1.44265 12.321 1.71512 12.2737C1.78094 12.2622 1.846 12.2446 1.91143 12.231C2.19194 12.1739 2.36988 12.2618 2.4644 12.553C2.54209 12.7924 2.58074 13.047 2.63278 13.2959C2.76021 13.9037 2.8731 14.5156 3.01967 15.118C3.06712 15.3135 3.18422 15.4983 3.29941 15.6642C3.45707 15.8917 3.68553 15.9357 3.92585 15.8121C4.05864 15.7435 4.18148 15.6523 4.31427 15.5833C4.55956 15.456 4.73712 15.511 4.837 15.7837C4.97936 16.173 5.0888 16.5763 5.21547 16.9722C5.37658 17.4749 5.60121 17.9328 6.02483 18.242C6.30113 18.4436 6.60612 18.5418 6.94287 18.5266C7.40324 18.5052 7.6271 18.1939 7.48857 17.7221C7.42352 17.5007 7.32402 17.2843 7.20769 17.088C6.73393 16.2889 6.23224 15.5078 5.7692 14.7016C5.21738 13.7415 4.74019 12.7386 4.45471 11.6454C4.28097 10.9805 4.18109 10.3062 4.29016 9.61259C4.44017 8.6586 4.9453 7.97853 5.71716 7.52064C6.51925 7.04467 7.38563 6.86931 8.29947 6.94816C8.81072 6.99211 9.31356 7.07383 9.78693 7.29641C9.90327 7.35103 10.0177 7.42413 10.1134 7.51283C10.3579 7.74035 10.3035 8.08243 10.0035 8.21385C9.70657 8.34403 9.41344 8.28695 9.12758 8.16169C8.756 7.99866 8.43914 7.7461 8.13874 7.4652C8.09167 7.42084 8.01016 7.38224 7.95276 7.39251C7.19621 7.5268 6.54642 7.87012 6.07382 8.54033C5.8997 8.78714 5.75734 9.05449 5.72634 9.37029C5.70415 9.5974 5.75849 9.68076 5.96399 9.73374C6.10711 9.7707 6.25559 9.78507 6.39986 9.8171C6.6685 9.87665 6.79669 10.0101 6.78292 10.3013C6.76876 10.6048 6.71021 10.907 6.65395 11.206C6.57933 11.6015 6.4829 11.9916 6.40521 12.3867C6.36312 12.6014 6.38838 12.8162 6.47333 13.0175C6.56938 13.2446 6.73126 13.3665 6.97081 13.3522C7.11852 13.3431 7.26624 13.3292 7.41395 13.3263C7.66499 13.3214 7.82609 13.4565 7.82112 13.7259C7.81576 14.0146 7.76104 14.3029 7.72048 14.5899C7.678 14.8881 7.61447 15.1829 7.58271 15.4819C7.55325 15.7579 7.62366 16.0117 7.82303 16.2063C7.95467 16.3348 8.10201 16.3788 8.26885 16.2839C8.34462 16.2408 8.42001 16.1969 8.49654 16.1558C8.68482 16.0552 8.79809 16.0872 8.90104 16.2856C8.96341 16.4055 9.00972 16.5353 9.05985 16.6626C9.2707 17.1985 9.54164 17.6888 9.9932 18.0338C10.235 18.2186 10.5033 18.3332 10.8087 18.3147C11.1102 18.2962 11.2717 18.1159 11.2729 17.7944C11.2744 17.332 11.1125 16.9316 10.842 16.5862C10.615 16.2962 10.3629 16.0293 10.1237 15.7501C10.0659 15.6823 10.0089 15.6112 9.96488 15.5332C9.84395 15.3184 9.89408 15.0946 10.0946 14.9636C10.196 14.8975 10.3085 14.8507 10.4141 14.792C10.7126 14.6265 10.7888 14.3427 10.5833 14.0569C10.457 13.8811 10.2852 13.7427 10.134 13.5871C9.99626 13.4458 9.83515 13.3218 9.72762 13.1575C9.62736 13.0043 9.56307 12.8142 9.51982 12.6302C9.46587 12.4031 9.5757 12.2343 9.76091 12.1238C9.89829 12.0421 10.0403 11.9686 10.1776 11.8861C10.4842 11.7017 10.558 11.4544 10.3808 11.1288C10.2611 10.9087 10.1076 10.7099 9.97215 10.4992C9.86309 10.3296 9.7655 10.1547 9.76971 9.93661C9.77507 9.6553 9.95914 9.45243 10.2213 9.44914C10.3598 9.4475 10.4983 9.45284 10.6369 9.45448C10.9097 9.45818 11.0544 9.36249 11.155 9.08899C11.2124 8.93252 11.2442 8.76579 11.297 8.60686C11.3463 8.45779 11.3995 8.30912 11.4657 8.16826C11.5756 7.93377 11.7531 7.81098 12.0061 7.81303C12.2537 7.81468 12.4335 7.93541 12.5319 8.16744C12.6298 8.39906 12.698 8.64505 12.7791 8.88447C12.8101 8.97564 12.8334 9.07051 12.8728 9.15716C12.9624 9.35387 13.1093 9.45982 13.3187 9.4553C13.4526 9.45243 13.5862 9.44996 13.7201 9.44914C14.1074 9.44709 14.3263 9.75345 14.1961 10.1444C14.1399 10.314 14.0354 10.4672 13.9428 10.6212C13.8395 10.7929 13.7124 10.9493 13.6179 11.1259C13.4438 11.4512 13.515 11.7013 13.8188 11.8844C13.9394 11.9571 14.0649 12.0203 14.1858 12.0918C14.4812 12.2668 14.5513 12.461 14.4533 12.8072C14.3714 13.0955 14.1835 13.2963 13.9795 13.486C13.8173 13.6372 13.6478 13.7801 13.4981 13.9447C13.4216 14.0289 13.3634 14.1452 13.3301 14.2581C13.267 14.4725 13.3374 14.6396 13.5192 14.7513C13.6267 14.817 13.7427 14.8667 13.8513 14.9299C14.1234 15.0876 14.1843 15.3464 13.9872 15.6043C13.8058 15.8416 13.5988 16.056 13.4009 16.2786C13.1652 16.5435 12.9459 16.8244 12.8395 17.1771C12.7776 17.3833 12.7412 17.6042 12.7297 17.8207C12.7148 18.1052 12.8897 18.2913 13.1576 18.311C13.6129 18.3447 13.9684 18.1192 14.2757 17.7899C14.588 17.4552 14.7946 17.0465 14.96 16.6112C15.0067 16.4884 15.0556 16.3648 15.1192 16.2515C15.2083 16.093 15.3178 16.0634 15.4728 16.141C15.5462 16.1776 15.6143 16.226 15.6867 16.2646C15.9063 16.3821 16.0889 16.3402 16.2431 16.1332C16.405 15.916 16.4551 15.6642 16.4122 15.3956C16.341 14.9472 16.2523 14.5016 16.1864 14.0523C16.1646 13.9049 16.1708 13.7439 16.2014 13.5981C16.2412 13.4084 16.3682 13.3246 16.5515 13.3259C16.6659 13.3267 16.7811 13.3312 16.8948 13.3439C17.3307 13.3924 17.6089 13.1575 17.5951 12.6828C17.5847 12.3238 17.5094 11.9653 17.4439 11.6109C17.38 11.2655 17.2798 10.9276 17.2197 10.5818C17.1944 10.436 17.2158 10.2754 17.2419 10.1267C17.2736 9.94564 17.4041 9.85612 17.5656 9.82244C17.7244 9.78918 17.8867 9.77111 18.044 9.73086C18.2468 9.67912 18.3141 9.56372 18.2751 9.34812C18.1775 8.80727 17.8786 8.40235 17.4967 8.06026C17.0792 7.68655 16.5871 7.48614 16.056 7.39497C15.9909 7.38388 15.8998 7.43029 15.8459 7.4808C15.552 7.75431 15.2416 7.99784 14.8804 8.16005C14.6236 8.27545 14.3595 8.32678 14.0844 8.24876C13.9061 8.19824 13.7687 8.0927 13.7377 7.88572C13.7078 7.68778 13.8173 7.55431 13.9551 7.45041C14.2424 7.23399 14.5754 7.142 14.9121 7.06562C15.8566 6.85083 16.7907 6.87342 17.703 7.23645C18.5403 7.56951 19.2146 8.10584 19.5601 9.02821C19.7438 9.51855 19.7821 10.0302 19.7362 10.5526C19.6233 11.8409 19.1503 12.9973 18.5537 14.0926C18.0053 15.0996 17.39 16.0646 16.814 17.0548C16.6893 17.2695 16.5798 17.5032 16.5098 17.7439C16.3785 18.196 16.6066 18.5122 17.0513 18.5258C17.7489 18.5471 18.2414 18.1751 18.5464 17.5377C18.7297 17.1545 18.8357 16.7291 18.9758 16.3221C19.0366 16.1447 19.0852 15.9615 19.1583 15.7907C19.2766 15.5143 19.4407 15.4556 19.6937 15.5882C19.8177 15.6531 19.9321 15.739 20.0561 15.8039C20.3197 15.9422 20.5294 15.8946 20.7193 15.6507C20.9267 15.3846 21.0311 15.0626 21.0981 14.7328C21.224 14.1135 21.3285 13.4893 21.4452 12.868C21.4659 12.7583 21.4949 12.6487 21.5351 12.5456C21.6419 12.2704 21.8103 12.1785 22.0831 12.2302C22.1956 12.2516 22.3089 12.2696 22.4222 12.2856C22.5454 12.3029 22.6495 12.2495 22.695 12.1329C22.7735 11.9321 22.8546 11.7259 22.891 11.5136C23.0031 10.8598 22.8837 10.2528 22.5178 9.70869C22.5094 9.69637 22.5014 9.68322 22.4926 9.67173C22.3085 9.43148 22.3093 9.43272 22.0548 9.57193C21.7529 9.73743 21.4406 9.85571 21.0931 9.78589C21.0281 9.77275 20.9615 9.75632 20.9026 9.72552C20.738 9.63969 20.6852 9.459 20.813 9.32266C20.9301 9.19822 21.0813 9.07954 21.2366 9.03231C22.24 8.72883 23.6961 9.31814 23.9552 10.7637C24.0547 11.3177 23.9812 11.8532 23.8021 12.3776C23.514 13.2216 23.0762 13.9764 22.5978 14.707C21.9706 15.6655 21.2596 16.55 20.5134 17.4026C20.0561 17.925 19.807 18.5369 19.8154 19.2613C19.8188 19.5722 19.8161 19.8834 19.8161 20.2025H4.18339C4.18339 20.1426 4.18415 20.0834 4.18339 20.0247C4.17765 19.6457 4.19525 19.2646 4.16081 18.8884C4.10609 18.2913 3.8363 17.7968 3.45554 17.3632C2.42881 16.1923 1.47174 14.9628 0.720543 13.5641C0.414784 12.9953 0.147675 12.4051 0.0409081 11.7505C-0.179131 10.3998 0.497059 9.24258 1.86283 8.98755C2.21145 8.92266 2.55778 8.9317 2.89032 9.07913C2.9726 9.11568 3.05373 9.16742 3.12031 9.23026C3.33346 9.4319 3.2841 9.67214 3.01355 9.76002C2.77743 9.83723 2.53941 9.82203 2.31057 9.73209C2.11425 9.65489 1.92559 9.55633 1.71818 9.46023L1.7178 9.459Z" fill="white"/><path d="M11.9953 21.6299C14.5612 21.6299 17.1266 21.6299 19.6925 21.6299C19.9026 21.6299 19.9451 21.6558 20.012 21.8771C20.1349 22.2833 20.1444 22.7038 20.1092 23.1235C20.0909 23.3457 20.0423 23.5662 19.9925 23.7838C19.9584 23.9325 19.867 23.9995 19.7086 23.9995C14.5677 23.9953 9.4264 23.9953 4.28551 23.9995C4.13435 23.9995 4.0559 23.9346 4.00922 23.7937C3.87566 23.3896 3.86074 22.9703 3.88523 22.5502C3.89824 22.3272 3.93459 22.103 3.98702 21.887C4.04251 21.6586 4.098 21.6303 4.3123 21.6303C6.87317 21.6303 9.43443 21.6303 11.9953 21.6303V21.6299Z" fill="white"/><path d="M13.0197 5.06697C13.1043 5.08216 13.1743 5.09202 13.2428 5.10803C13.389 5.14253 13.4552 5.25505 13.4701 5.40248C13.5509 6.20781 13.0431 6.90431 12.2965 7.04927C11.6053 7.18356 10.9655 6.8193 10.7026 6.30925C10.5606 6.03369 10.5032 5.73882 10.5227 5.4263C10.5377 5.19058 10.6816 5.08093 10.9368 5.0797C11.0007 4.80291 11.0355 4.52283 11.1312 4.26862C11.2839 3.86206 11.6692 3.66699 12.0722 3.70108C12.4767 3.73557 12.7882 3.93968 12.9263 4.40373C12.9761 4.57047 12.986 4.75116 13.0117 4.9257C13.0189 4.97457 13.0178 5.02508 13.0197 5.06656V5.06697Z" fill="white"/><path d="M12.4722 1.11837C12.4634 1.45553 12.4056 1.76969 12.2476 2.05387C12.0892 2.33847 11.9039 2.34586 11.7578 2.05839C11.4474 1.4469 11.4478 0.823507 11.7578 0.21243C11.9039 -0.07545 12.0903 -0.0668259 12.2484 0.21859C12.403 0.498256 12.4607 0.80708 12.4718 1.11878L12.4722 1.11837Z" fill="white"/><path d="M10.547 2.26318C10.8417 2.27797 11.123 2.34326 11.3721 2.52273C11.612 2.69562 11.6105 2.88617 11.3713 3.06317C10.919 3.39787 10.1598 3.3954 9.70706 3.05783C9.47822 2.88699 9.47593 2.69439 9.70783 2.52478C9.96001 2.3408 10.247 2.27591 10.547 2.26318Z" fill="white"/><path d="M13.4541 3.32398C13.1636 3.30098 12.885 3.24143 12.6386 3.06854C12.3887 2.89319 12.3872 2.69812 12.6317 2.51989C13.089 2.18642 13.826 2.18601 14.2856 2.51906C14.5301 2.69647 14.5294 2.89195 14.2799 3.06772C14.0292 3.24431 13.746 3.30344 13.4544 3.32439L13.4541 3.32398Z" fill="white"/></g><defs><clipPath id="clip0_3765_33112"><rect width="24" height="24" fill="white"/></clipPath></defs></svg>',
          color: "rgba(0, 110, 122, 1)",
          applicationFormUrlPreliminaryExamination:
            "https://lbst.dk/tilskud/tast-selv",
          applicationFormUrlEstablishment: "https://lbst.dk/tilskud/tast-selv",
          applicationFormUrlPayment: "https://lbst.dk/tilskud/tast-selv",
          minAreaHa: null,
          requiredCarbonOverlapPercentage: 60,
          applicationPeriods: [],
          subsidySchemeOverlaps: [],
          active: true,
          allowPrivateUserApply: true,
          allowPrivateCompanyApply: true,
          allowMunicipalityApply: true,
          allowOrganizationVatApply: ["DK42909769", "DK33157274", "DK20814616"],
          f2Integration: false,
          supplementaryGeometryTypes: [],
        },
        dateOfApplication: "2025-05-14T12:00:00+00:00",
        nitrogenReductionT: 0.971408387324122,
        nitrogenReductionTOverridden: false,
        extractionEffortHa: 27.577062266421354,
        extractionEffortHaOverridden: false,
        afforestationEffortHa: null,
        afforestationEffortHaOverridden: false,
        areaHa: 27.577062266421354,
        f2FormUrl: null,
        latestSnapshot: {
          stateNr: 6,
          geoLocationId: "b565af9e-4b01-4592-b07e-6f4671f8d695",
          areaHa: 27.577062266421354,
          nitrogenReductionT: 2.179247546181744,
          extractionEffortHa: 0.019930727855302394,
          afforestationEffortHa: null,
          created: "2025-05-15T04:21:46.500189+00:00",
        },
        creator: {
          user: {
            id: "f273168c-4a3b-4917-a457-0a4d5f7233e2",
            name: "USa_MST_ MARS_Planl칝gger",
          },
          organization: {
            id: "5e252de1-f4ad-45be-9948-860c3a91c82e",
            name: "Milj칮styrelsen",
            vat: "DK25798376",
          },
        },
        owner: {
          user: null,
          organization: {
            id: "5e252de1-f4ad-45be-9948-860c3a91c82e",
            name: "Milj칮styrelsen",
            vat: "DK25798376",
          },
        },
        created: "2025-05-14T07:26:56.264486+00:00",
        updated: "2025-06-30T09:02:38.814888+00:00",
        lastStateChanged: "2025-06-30T09:02:38.807161+00:00",

        mitigationColor: "rgba(0, 61, 35, 1)", // Example color for the project
        geometryWkt:
          "MULTIPOLYGON (((536848.5353188185 6346864.170815518, 535613.6147526584 6347336.0288243815, 536478.9213975612 6348476.804757819, 537180.4315420579 6348292.5509164715, 536848.5353188185 6346864.170815518)))",
        snapshotGeometryWkt:
          "MULTIPOLYGON (((536618.7629581506 6347131.985142916, 535899.5790435629 6347431.573652884, 536478.9213975612 6348476.804757819, 537138.1733192666 6348110.641003096, 536618.7629581506 6347131.985142916)))",
      };

      // Define EPSG:25832 projection (UTM Zone 32N, ETRS89)
      proj4.defs(
        "EPSG:25832",
        "+proj=utm +zone=32 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
      );
      ol.proj.proj4.register(proj4);

      const mapZoomPaddingPx = 20; // Padding for zooming
      const extent = [230000, 6025000, 905000, 6450000]; // Map extent for Denmark in EPSG:25832

      // Function to load layers from data catalog
      async function loadLayersFromCatalog() {
        try {
          // Create layers from the catalog data using URLs from targetLayers
          const targetLayers = [
            "urn:dmp:ds:skaermkort-daempet",
            // 'urn:dmp:ds:ortofoto-foraar-nyeste-tilgaengelige'
          ];

          // Build params object
          const params = {
            include: [
              "thumbnail",
              "wfsSource",
              "wmsSource.legends.image",
              "wmtsSource.legends.image",
              "license",
              "dataLiabilityAgreement",
              "previewImages.image",
              "livePreviews.previewImage",
              "owners.thumbnail",
              "related",
              "tags",
              "category.thumbnail",
            ].join(","),
            filter: `any(id,${targetLayers
              .map((id) => `%27${encodeURIComponent(id)}%27`)
              .join(",")})`,
            locale: "da-DK",
            orgname: "MST",
            appname: "MARS",
            appurlname: encodeURIComponent("https://mars.sgav.dk"),
            componentname: encodeURIComponent("@dmp/map-components"),
          };

          // Build query string from params object
          const queryString = Object.entries(params)
            .map(([key, value]) => `${key}=${value}`)
            .join("&");

          const catalogUrl = `https://datakatalog.miljoeportal.dk/api/datasets?${queryString}`;

          const response = await fetch(catalogUrl, {
            method: "GET",
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          // Find WMS and WMTS sources in the included data
          const wmsSources =
            data.included?.filter((item) => item.type === "wmsSources") || [];
          const wmtsSources =
            data.included?.filter((item) => item.type === "wmtsSources") || [];

          targetLayers.forEach((layerId) => {
            console.log(`Processing layer: ${layerId}`);
            const dataset = data.data.find((item) => item.id === layerId);

            if (dataset) {
              console.log(`Found dataset: ${dataset.attributes.title}`);
              let layer = null;

              // Try to create WMTS layer first (faster)
              if (dataset.relationships?.wmtsSource?.data) {
                const wmtsSourceId = dataset.relationships.wmtsSource.data.id;
                const wmtsSource = wmtsSources.find(
                  (source) => source.id === wmtsSourceId
                );

                if (wmtsSource) {
                  try {
                    // Parse extent from the wmtsSource
                    const extentString = wmtsSource.attributes.extent;
                    let extent = null;
                    if (extentString) {
                      extent = extentString.split(",").map(Number);
                    }

                    layer = new ol.layer.Tile({
                      source: new ol.source.WMTS({
                        url: wmtsSource.attributes.url,
                        layer: wmtsSource.attributes.layer,
                        matrixSet: wmtsSource.attributes.matrixSet,
                        format: wmtsSource.attributes.format,
                        style: wmtsSource.attributes.style || "default",
                        tileGrid: new ol.tilegrid.WMTS({
                          origin: extent
                            ? [extent[0], extent[3]]
                            : [120000, 6500000], // Use extent or default
                          resolutions: wmtsSource.attributes.resolutions
                            .split(",")
                            .map(Number),
                          matrixIds: wmtsSource.attributes.matrixIds.split(","),
                          extent: extent,
                        }),
                      }),
                      visible: true,
                      opacity: 1.0,
                    });
                  } catch (wmtsError) {
                    console.error(
                      `Error creating WMTS layer: ${wmtsError.message}`
                    );
                  }
                }
              }

              // Fallback to WMS if WMTS is not available
              if (!layer && dataset.relationships?.wmsSource?.data) {
                const wmsSourceId = dataset.relationships.wmsSource.data.id;
                const wmsSource = wmsSources.find(
                  (source) => source.id === wmsSourceId
                );

                if (wmsSource) {
                  try {
                    layer = new ol.layer.Tile({
                      source: new ol.source.TileWMS({
                        url: wmsSource.attributes.url,
                        params: {
                          LAYERS: wmsSource.attributes.layer || layerId,
                          FORMAT: "image/png",
                          TRANSPARENT: true,
                          CRS: "EPSG:25832",
                        },
                        projection: "EPSG:25832",
                      }),
                      visible: true,
                      opacity: 1.0,
                    });
                  } catch (wmsError) {
                    console.error(
                      `Error creating WMS layer: ${wmsError.message}`
                    );
                  }
                }
              }

              // Add the layer to the map if created successfully
              if (layer) {
                map.addLayer(layer);
                console.log(
                  `Successfully added layer: ${dataset.attributes.title}`
                );
              } else {
                console.warn(`Could not create layer for: ${layerId}`);
              }
            } else {
              console.warn(`Dataset not found for: ${layerId}`);
            }
          });

          console.log(`Total layers loaded: ${map.getLayers().getLength()}`);
        } catch (error) {
          console.error("Error loading layers from catalog:", error);
        }
      }

      async function loadProjectGeometry() {
        return new Promise(async (resolve, reject) => {
          try {
            // Parse the WKT geometry for the main project geometry
            const wktFormat = new ol.format.WKT();
            const geometry = wktFormat.readGeometry(project.geometryWkt, {
              dataProjection: "EPSG:25832",
              featureProjection: "EPSG:25832",
            });

            const mitigationColor = project.mitigationColor;
            // Create a vector layer for the project geometry
            const projectLayer = new ol.layer.Vector({
              source: new ol.source.Vector({
                features: [new ol.Feature(geometry)],
              }),
              zIndex: 1010,
              style: getProjectStyle(mitigationColor),
            });

            map.addLayer(projectLayer);

            if (!!project.snapshotGeometryWkt) {
              // Parse the WKT geometry for the snapshot geometry
              const snapshotGeometry = wktFormat.readGeometry(
                project.snapshotGeometryWkt,
                {
                  dataProjection: "EPSG:25832",
                  featureProjection: "EPSG:25832",
                }
              );

              // Create a vector layer for the snapshot geometry
              const snapshotLayer = new ol.layer.Vector({
                source: new ol.source.Vector({
                  features: [new ol.Feature(snapshotGeometry)],
                }),
                zIndex: 1000,
                style: getSnapshotProjectStyle(mitigationColor),
              });

              map.addLayer(snapshotLayer);
            }

            // Zoom to the extent of the project geometry
            const extent = geometry.getExtent();
            zoomMaptoExtent(map, extent);
            resolve(true);
          } catch (error) {
            console.error("Error loading project geometry:", error);
            reject(error);
          }
        });
      }

      function zoomMaptoExtent(map, extent) {
        map.getView().fit(extent, {
          minResolution: 0.2,
          padding: [
            mapZoomPaddingPx,
            mapZoomPaddingPx,
            mapZoomPaddingPx,
            mapZoomPaddingPx,
          ],
          duration: 0,
          nearest: true,
        });
      }
      // #endregion

      // #region Style Management

      const defaultStrokeWidth = 2;
      const whiteStrokeWidth = 6;
      const hoverOpacity = 0.5; // 0.5 default hover opacity
      const selectedOpacity = 0.2; // 0.2 default select opacity

      const whiteColor = [255, 255, 255, 1];
      const transparentFill = [0, 255, 255, 0];
      const defaultStrokeColor = [23, 94, 123, 1];
      const modifyPointColor = [40, 120, 118, 0.3];
      const projectNoVirkemiddelColor = [11, 45, 59, 1];
      const defaultFillColor = defaultStrokeColor.with(3, 0.05);

      function getProjectStyle(color) {
        const strokeNums =
          typeof color === "string" ? ol.color.fromString(color) : color;
        return [
          new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: strokeNums,
              width: 3,
            }),
            fill: new ol.style.Fill({
              color: strokeNums.with(3, 0.3),
            }),
            zIndex: 2,
          }),
          new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: whiteColor,
              width: 8,
            }),
            zIndex: 1,
          }),
        ];
      }

      function getSnapshotProjectStyle(strokeColor) {
        return [
          new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: strokeColor,
              width: 3,
              lineDash: [15, 10],
            }),
            fill: new ol.style.Fill({
              color: transparentFill,
            }),
            zIndex: 2,
          }),
          new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: whiteColor,
              width: 8,
            }),
            zIndex: 1,
          }),
        ];
      }

      // #endregion
      async function readyForPDFFunc(timeoutMs = 30000) {
        return new Promise((resolve, reject) => {
          // Check if already ready
          if (readyForPDF) {
            resolve(true);
            return;
          }

          let timeoutId = null;
          let intervalId = null;
          let startTime = Date.now();

          // Cleanup function to prevent memory leaks
          const cleanup = () => {
            if (timeoutId) {
              clearTimeout(timeoutId);
              timeoutId = null;
            }
            if (intervalId) {
              clearInterval(intervalId);
              intervalId = null;
            }
          };

          // Set up timeout to prevent infinite waiting
          timeoutId = setTimeout(() => {
            cleanup();
            reject(new Error(`readyForPDF timeout after ${timeoutMs}ms`));
          }, timeoutMs);

          // Use setInterval instead of recursive setTimeout for better performance
          intervalId = setInterval(() => {
            if (readyForPDF) {
              cleanup();
              resolve(true);
            } else {
              // Additional safety check for elapsed time
              const elapsed = Date.now() - startTime;
              if (elapsed >= timeoutMs) {
                cleanup();
                reject(new Error(`readyForPDF timeout after ${elapsed}ms`));
              }
            }
          }, 100);
        });
      }

      // Create the map variable (will be initialized in Vue)
      let map;
      let readyForPDF = false;

      // Expose map and readyForPDFFunc to global scope for PDF generation
      window.readyForPDFFunc = readyForPDFFunc;

      // Create a map view
      const view = new ol.View({
        center: [665690, 6237500],
        extent: extent,
        projection: "EPSG:25832", // Use EPSG:25832 for Danish data
        zoom: 1,
      });

      map = new ol.Map({
        target: "map",
        layers: [],
        view: view,
      });

      // Expose map to global scope for PDF generation
      window.map = map;

      // Initialize the map after Vue is mounted to ensure DOM is ready
      loadLayersFromCatalog()
        .then(() => {
          console.log("Layers loaded successfully");
          loadProjectGeometry().then(() => {
            if (map && map.getView() && map.getLayers().getLength() > 0) {
              // Wait for the next render complete event to ensure all layers are loaded
              map.once("rendercomplete", () => {
                readyForPDF = true;
                console.log("Map is ready for PDF generation");
              });

              // Force a re-render to trigger the event
              map.getView().changed();
            } else {
              // If map isn't ready yet, wait a bit and try again
              setTimeout(() => {
                readyForPDF().then(resolve);
              }, 100);
            }
          });
        })
        .catch((error) => {
          console.error("Error loading layers:", error);
        });
    </script>
    <style type="text/css">
      /* Reset and base styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        line-height: 1.6;
        color: #333;
      }

      #app {
        display: flex;
        flex-direction: column;
      }

      /* Map styles */
      .map-container {
        width: 100%;
      }

      #map {
        width: 100%;
        height: 300px;
      }

      /* Info section styles */
      .info-section {
        margin-top: 1rem;
      }

      .general-info {
        padding: 20px;
        display: flex;
        flex-direction: column;
      }

      .general-info h2 {
        margin-bottom: 1rem;
        font-size: 1.5rem;
      }

      .project-details,
      .subsidy-details,
      .effects-details,
      .forest-details,
      .untouched-forest-details {
        margin-bottom: 2rem;
      }

      .info-item {
        margin-bottom: 0.5rem;
        line-height: 1.5;
      }

      .info-item strong {
        font-weight: 600;
        color: #212529;
      }

      .description-box {
        margin-top: 0.25rem;
        padding: 0.5rem;
        border-radius: 4px;
      }

      /* Table styles */
      .forest-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 0.5rem;
      }

      .forest-table th,
      .forest-table td {
        padding: 8px 12px;
        text-align: left;
        border: 1px solid #ddd;
      }

      .forest-table th {
        background-color: #f8f9fa;
        font-weight: 600;
        color: #212529;
      }

      .forest-table tbody tr:nth-child(even) {
        background-color: #f8f9fa;
      }

      .forest-table tbody tr:hover {
        background-color: #e9ecef;
      }
    </style>
  </body>
</html>
