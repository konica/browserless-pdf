<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>F2 Integration</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <!-- OpenLayers CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ol@v10.6.0/ol.css"
    />
  </head>
  <body>
    <div id="app" class="container-fluid">
      <div class="row">
        <div class="col-12" ref="mapContainer" id="map"></div>
      </div>
      <div class="row mt-3">
        <div class="general-info d-flex flex-column justify-content-start">
          <h2>Project information</h2>
          <div class="project-details">
            <div class="mb-2"><strong>Name:</strong> {{ project.name }}</div>
            <div class="mb-2">
              <strong>Description:</strong> {{ project.description || "N/A" }}
            </div>
            <div class="mb-2">
              <strong>Version:</strong> {{ project.caseId || "N/A" }}
            </div>
            <div class="mb-2">
              <strong>Created:</strong> {{ formatDate(project.created) }}
            </div>
            <div class="mb-2">
              <strong>Updated:</strong> {{ formatDate(project.updated) }}
            </div>
            <div class="mb-2">
              <strong>Last state changed:</strong> {{
              formatDate(project.lastStateChanged) }}
            </div>
            <div class="mb-2">
              <strong>Link to Project:</strong>
              <a
                :href="project.linkToProject"
                target="_blank"
                class="text-primary"
                >{{ project.linkToProject }}</a
              >
            </div>
          </div>

          <hr class="my-4" />

          <h2>Subsidy scheme</h2>
          <div class="subsidy-details">
            <div class="mb-2">
              <strong>Name:</strong> {{ project.subsidyScheme.name }}
            </div>
            <div class="mb-2">
              <strong>Description:</strong>
              <div class="mt-1 p-2 bg-light rounded">
                {{ project.subsidyScheme.description }}
              </div>
            </div>
            <div class="mb-2">
              <strong>Organization:</strong> {{
              project.subsidyScheme.organization }}
            </div>
            <div class="mb-2">
              <strong>Owner VAT:</strong> {{ project.subsidyScheme.ownerVat }}
            </div>
            <div class="mb-2">
              <strong>Active:</strong> {{ project.subsidyScheme.active ? 'Yes' :
              'No' }}
            </div>
            <div class="mb-2">
              <strong>URL:</strong>
              <a
                :href="project.subsidyScheme.url"
                target="_blank"
                class="text-primary"
                >{{ project.subsidyScheme.url }}</a
              >
            </div>
            <div class="mb-2">
              <strong>Mitigation measure:</strong>
              {{ mitigationMeasure?.name || "N/A" }}
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/ol@v10.6.0/dist/ol.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/proj4@2.8.0/dist/proj4.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
      // Declare the project variable
      const project = {
        id: "402a966e-6d9f-41ff-9bda-23cc55ba5d76",
        name: "\uD83E\uDD75 MST - DDH - Delete - 1",
        description: null,
        caseId: null,
        stateNr: 6,
        geoLocationId: "dfde1cd6-27b3-40d7-b79e-a5e5dc11e936",
        subsidyScheme: {
          id: "a1f3e207-4a9c-433d-a58a-dca8e12feabf",
          name: "Kvælstofvådområder",
          organization: "SGAV",
          ownerVat: "DK20814616",
          flowNr: 1,
          mitigationMeasureId: "85bffbd9-fc34-41b8-8302-df2fb124f394",
          description:
            "Du kan søge tilskud til at lave et kvælstofvådområde under Styrelsen for Grøn Arealomlægning og Vandmiljøs ordning til Vand- og Klimaprojekter. Et kvælstofvådområde har til formål at genskabe naturlige vandforhold, så udledningen af kvælstof til vores kystvande, fjorde og søer mindskes. Kvælstofvådområdeordningen kan søges af kommuner og Naturstyrelsen, som gennemfører projekterne gennem frivillige aftaler med lodsejere.",
          url: "https://sgavmst.dk/tilskud/tilskud-til-vand-og-klimaprojekter/kvaelstof-og-fosforvaadomraader",
          icon: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_3765_33112)"><path d="M1.7178 9.459C1.49623 9.63025 1.34584 9.88117 1.24022 10.1654C1.01712 10.7666 1.00908 11.3723 1.22797 11.9768C1.329 12.2557 1.44265 12.321 1.71512 12.2737C1.78094 12.2622 1.846 12.2446 1.91143 12.231C2.19194 12.1739 2.36988 12.2618 2.4644 12.553C2.54209 12.7924 2.58074 13.047 2.63278 13.2959C2.76021 13.9037 2.8731 14.5156 3.01967 15.118C3.06712 15.3135 3.18422 15.4983 3.29941 15.6642C3.45707 15.8917 3.68553 15.9357 3.92585 15.8121C4.05864 15.7435 4.18148 15.6523 4.31427 15.5833C4.55956 15.456 4.73712 15.511 4.837 15.7837C4.97936 16.173 5.0888 16.5763 5.21547 16.9722C5.37658 17.4749 5.60121 17.9328 6.02483 18.242C6.30113 18.4436 6.60612 18.5418 6.94287 18.5266C7.40324 18.5052 7.6271 18.1939 7.48857 17.7221C7.42352 17.5007 7.32402 17.2843 7.20769 17.088C6.73393 16.2889 6.23224 15.5078 5.7692 14.7016C5.21738 13.7415 4.74019 12.7386 4.45471 11.6454C4.28097 10.9805 4.18109 10.3062 4.29016 9.61259C4.44017 8.6586 4.9453 7.97853 5.71716 7.52064C6.51925 7.04467 7.38563 6.86931 8.29947 6.94816C8.81072 6.99211 9.31356 7.07383 9.78693 7.29641C9.90327 7.35103 10.0177 7.42413 10.1134 7.51283C10.3579 7.74035 10.3035 8.08243 10.0035 8.21385C9.70657 8.34403 9.41344 8.28695 9.12758 8.16169C8.756 7.99866 8.43914 7.7461 8.13874 7.4652C8.09167 7.42084 8.01016 7.38224 7.95276 7.39251C7.19621 7.5268 6.54642 7.87012 6.07382 8.54033C5.8997 8.78714 5.75734 9.05449 5.72634 9.37029C5.70415 9.5974 5.75849 9.68076 5.96399 9.73374C6.10711 9.7707 6.25559 9.78507 6.39986 9.8171C6.6685 9.87665 6.79669 10.0101 6.78292 10.3013C6.76876 10.6048 6.71021 10.907 6.65395 11.206C6.57933 11.6015 6.4829 11.9916 6.40521 12.3867C6.36312 12.6014 6.38838 12.8162 6.47333 13.0175C6.56938 13.2446 6.73126 13.3665 6.97081 13.3522C7.11852 13.3431 7.26624 13.3292 7.41395 13.3263C7.66499 13.3214 7.82609 13.4565 7.82112 13.7259C7.81576 14.0146 7.76104 14.3029 7.72048 14.5899C7.678 14.8881 7.61447 15.1829 7.58271 15.4819C7.55325 15.7579 7.62366 16.0117 7.82303 16.2063C7.95467 16.3348 8.10201 16.3788 8.26885 16.2839C8.34462 16.2408 8.42001 16.1969 8.49654 16.1558C8.68482 16.0552 8.79809 16.0872 8.90104 16.2856C8.96341 16.4055 9.00972 16.5353 9.05985 16.6626C9.2707 17.1985 9.54164 17.6888 9.9932 18.0338C10.235 18.2186 10.5033 18.3332 10.8087 18.3147C11.1102 18.2962 11.2717 18.1159 11.2729 17.7944C11.2744 17.332 11.1125 16.9316 10.842 16.5862C10.615 16.2962 10.3629 16.0293 10.1237 15.7501C10.0659 15.6823 10.0089 15.6112 9.96488 15.5332C9.84395 15.3184 9.89408 15.0946 10.0946 14.9636C10.196 14.8975 10.3085 14.8507 10.4141 14.792C10.7126 14.6265 10.7888 14.3427 10.5833 14.0569C10.457 13.8811 10.2852 13.7427 10.134 13.5871C9.99626 13.4458 9.83515 13.3218 9.72762 13.1575C9.62736 13.0043 9.56307 12.8142 9.51982 12.6302C9.46587 12.4031 9.5757 12.2343 9.76091 12.1238C9.89829 12.0421 10.0403 11.9686 10.1776 11.8861C10.4842 11.7017 10.558 11.4544 10.3808 11.1288C10.2611 10.9087 10.1076 10.7099 9.97215 10.4992C9.86309 10.3296 9.7655 10.1547 9.76971 9.93661C9.77507 9.6553 9.95914 9.45243 10.2213 9.44914C10.3598 9.4475 10.4983 9.45284 10.6369 9.45448C10.9097 9.45818 11.0544 9.36249 11.155 9.08899C11.2124 8.93252 11.2442 8.76579 11.297 8.60686C11.3463 8.45779 11.3995 8.30912 11.4657 8.16826C11.5756 7.93377 11.7531 7.81098 12.0061 7.81303C12.2537 7.81468 12.4335 7.93541 12.5319 8.16744C12.6298 8.39906 12.698 8.64505 12.7791 8.88447C12.8101 8.97564 12.8334 9.07051 12.8728 9.15716C12.9624 9.35387 13.1093 9.45982 13.3187 9.4553C13.4526 9.45243 13.5862 9.44996 13.7201 9.44914C14.1074 9.44709 14.3263 9.75345 14.1961 10.1444C14.1399 10.314 14.0354 10.4672 13.9428 10.6212C13.8395 10.7929 13.7124 10.9493 13.6179 11.1259C13.4438 11.4512 13.515 11.7013 13.8188 11.8844C13.9394 11.9571 14.0649 12.0203 14.1858 12.0918C14.4812 12.2668 14.5513 12.461 14.4533 12.8072C14.3714 13.0955 14.1835 13.2963 13.9795 13.486C13.8173 13.6372 13.6478 13.7801 13.4981 13.9447C13.4216 14.0289 13.3634 14.1452 13.3301 14.2581C13.267 14.4725 13.3374 14.6396 13.5192 14.7513C13.6267 14.817 13.7427 14.8667 13.8513 14.9299C14.1234 15.0876 14.1843 15.3464 13.9872 15.6043C13.8058 15.8416 13.5988 16.056 13.4009 16.2786C13.1652 16.5435 12.9459 16.8244 12.8395 17.1771C12.7776 17.3833 12.7412 17.6042 12.7297 17.8207C12.7148 18.1052 12.8897 18.2913 13.1576 18.311C13.6129 18.3447 13.9684 18.1192 14.2757 17.7899C14.588 17.4552 14.7946 17.0465 14.96 16.6112C15.0067 16.4884 15.0556 16.3648 15.1192 16.2515C15.2083 16.093 15.3178 16.0634 15.4728 16.141C15.5462 16.1776 15.6143 16.226 15.6867 16.2646C15.9063 16.3821 16.0889 16.3402 16.2431 16.1332C16.405 15.916 16.4551 15.6642 16.4122 15.3956C16.341 14.9472 16.2523 14.5016 16.1864 14.0523C16.1646 13.9049 16.1708 13.7439 16.2014 13.5981C16.2412 13.4084 16.3682 13.3246 16.5515 13.3259C16.6659 13.3267 16.7811 13.3312 16.8948 13.3439C17.3307 13.3924 17.6089 13.1575 17.5951 12.6828C17.5847 12.3238 17.5094 11.9653 17.4439 11.6109C17.38 11.2655 17.2798 10.9276 17.2197 10.5818C17.1944 10.436 17.2158 10.2754 17.2419 10.1267C17.2736 9.94564 17.4041 9.85612 17.5656 9.82244C17.7244 9.78918 17.8867 9.77111 18.044 9.73086C18.2468 9.67912 18.3141 9.56372 18.2751 9.34812C18.1775 8.80727 17.8786 8.40235 17.4967 8.06026C17.0792 7.68655 16.5871 7.48614 16.056 7.39497C15.9909 7.38388 15.8998 7.43029 15.8459 7.4808C15.552 7.75431 15.2416 7.99784 14.8804 8.16005C14.6236 8.27545 14.3595 8.32678 14.0844 8.24876C13.9061 8.19824 13.7687 8.0927 13.7377 7.88572C13.7078 7.68778 13.8173 7.55431 13.9551 7.45041C14.2424 7.23399 14.5754 7.142 14.9121 7.06562C15.8566 6.85083 16.7907 6.87342 17.703 7.23645C18.5403 7.56951 19.2146 8.10584 19.5601 9.02821C19.7438 9.51855 19.7821 10.0302 19.7362 10.5526C19.6233 11.8409 19.1503 12.9973 18.5537 14.0926C18.0053 15.0996 17.39 16.0646 16.814 17.0548C16.6893 17.2695 16.5798 17.5032 16.5098 17.7439C16.3785 18.196 16.6066 18.5122 17.0513 18.5258C17.7489 18.5471 18.2414 18.1751 18.5464 17.5377C18.7297 17.1545 18.8357 16.7291 18.9758 16.3221C19.0366 16.1447 19.0852 15.9615 19.1583 15.7907C19.2766 15.5143 19.4407 15.4556 19.6937 15.5882C19.8177 15.6531 19.9321 15.739 20.0561 15.8039C20.3197 15.9422 20.5294 15.8946 20.7193 15.6507C20.9267 15.3846 21.0311 15.0626 21.0981 14.7328C21.224 14.1135 21.3285 13.4893 21.4452 12.868C21.4659 12.7583 21.4949 12.6487 21.5351 12.5456C21.6419 12.2704 21.8103 12.1785 22.0831 12.2302C22.1956 12.2516 22.3089 12.2696 22.4222 12.2856C22.5454 12.3029 22.6495 12.2495 22.695 12.1329C22.7735 11.9321 22.8546 11.7259 22.891 11.5136C23.0031 10.8598 22.8837 10.2528 22.5178 9.70869C22.5094 9.69637 22.5014 9.68322 22.4926 9.67173C22.3085 9.43148 22.3093 9.43272 22.0548 9.57193C21.7529 9.73743 21.4406 9.85571 21.0931 9.78589C21.0281 9.77275 20.9615 9.75632 20.9026 9.72552C20.738 9.63969 20.6852 9.459 20.813 9.32266C20.9301 9.19822 21.0813 9.07954 21.2366 9.03231C22.24 8.72883 23.6961 9.31814 23.9552 10.7637C24.0547 11.3177 23.9812 11.8532 23.8021 12.3776C23.514 13.2216 23.0762 13.9764 22.5978 14.707C21.9706 15.6655 21.2596 16.55 20.5134 17.4026C20.0561 17.925 19.807 18.5369 19.8154 19.2613C19.8188 19.5722 19.8161 19.8834 19.8161 20.2025H4.18339C4.18339 20.1426 4.18415 20.0834 4.18339 20.0247C4.17765 19.6457 4.19525 19.2646 4.16081 18.8884C4.10609 18.2913 3.8363 17.7968 3.45554 17.3632C2.42881 16.1923 1.47174 14.9628 0.720543 13.5641C0.414784 12.9953 0.147675 12.4051 0.0409081 11.7505C-0.179131 10.3998 0.497059 9.24258 1.86283 8.98755C2.21145 8.92266 2.55778 8.9317 2.89032 9.07913C2.9726 9.11568 3.05373 9.16742 3.12031 9.23026C3.33346 9.4319 3.2841 9.67214 3.01355 9.76002C2.77743 9.83723 2.53941 9.82203 2.31057 9.73209C2.11425 9.65489 1.92559 9.55633 1.71818 9.46023L1.7178 9.459Z" fill="white"/><path d="M11.9953 21.6299C14.5612 21.6299 17.1266 21.6299 19.6925 21.6299C19.9026 21.6299 19.9451 21.6558 20.012 21.8771C20.1349 22.2833 20.1444 22.7038 20.1092 23.1235C20.0909 23.3457 20.0423 23.5662 19.9925 23.7838C19.9584 23.9325 19.867 23.9995 19.7086 23.9995C14.5677 23.9953 9.4264 23.9953 4.28551 23.9995C4.13435 23.9995 4.0559 23.9346 4.00922 23.7937C3.87566 23.3896 3.86074 22.9703 3.88523 22.5502C3.89824 22.3272 3.93459 22.103 3.98702 21.887C4.04251 21.6586 4.098 21.6303 4.3123 21.6303C6.87317 21.6303 9.43443 21.6303 11.9953 21.6303V21.6299Z" fill="white"/><path d="M13.0197 5.06697C13.1043 5.08216 13.1743 5.09202 13.2428 5.10803C13.389 5.14253 13.4552 5.25505 13.4701 5.40248C13.5509 6.20781 13.0431 6.90431 12.2965 7.04927C11.6053 7.18356 10.9655 6.8193 10.7026 6.30925C10.5606 6.03369 10.5032 5.73882 10.5227 5.4263C10.5377 5.19058 10.6816 5.08093 10.9368 5.0797C11.0007 4.80291 11.0355 4.52283 11.1312 4.26862C11.2839 3.86206 11.6692 3.66699 12.0722 3.70108C12.4767 3.73557 12.7882 3.93968 12.9263 4.40373C12.9761 4.57047 12.986 4.75116 13.0117 4.9257C13.0189 4.97457 13.0178 5.02508 13.0197 5.06656V5.06697Z" fill="white"/><path d="M12.4722 1.11837C12.4634 1.45553 12.4056 1.76969 12.2476 2.05387C12.0892 2.33847 11.9039 2.34586 11.7578 2.05839C11.4474 1.4469 11.4478 0.823507 11.7578 0.21243C11.9039 -0.07545 12.0903 -0.0668259 12.2484 0.21859C12.403 0.498256 12.4607 0.80708 12.4718 1.11878L12.4722 1.11837Z" fill="white"/><path d="M10.547 2.26318C10.8417 2.27797 11.123 2.34326 11.3721 2.52273C11.612 2.69562 11.6105 2.88617 11.3713 3.06317C10.919 3.39787 10.1598 3.3954 9.70706 3.05783C9.47822 2.88699 9.47593 2.69439 9.70783 2.52478C9.96001 2.3408 10.247 2.27591 10.547 2.26318Z" fill="white"/><path d="M13.4541 3.32398C13.1636 3.30098 12.885 3.24143 12.6386 3.06854C12.3887 2.89319 12.3872 2.69812 12.6317 2.51989C13.089 2.18642 13.826 2.18601 14.2856 2.51906C14.5301 2.69647 14.5294 2.89195 14.2799 3.06772C14.0292 3.24431 13.746 3.30344 13.4544 3.32439L13.4541 3.32398Z" fill="white"/></g><defs><clipPath id="clip0_3765_33112"><rect width="24" height="24" fill="white"/></clipPath></defs></svg>',
          color: "rgba(0, 110, 122, 1)",
          applicationFormUrlPreliminaryExamination:
            "https://lbst.dk/tilskud/tast-selv",
          applicationFormUrlEstablishment: "https://lbst.dk/tilskud/tast-selv",
          applicationFormUrlPayment: "https://lbst.dk/tilskud/tast-selv",
          minAreaHa: null,
          requiredCarbonOverlapPercentage: null,
          applicationPeriods: [],
          subsidySchemeOverlaps: [],
          active: true,
          allowPrivateUserApply: true,
          allowPrivateCompanyApply: true,
          allowMunicipalityApply: true,
          allowOrganizationVatApply: ["DK42909769", "DK33157274", "DK20814616"],
          f2Integration: false,
          supplementaryGeometryTypes: [],
        },
        dateOfApplication: "2025-05-14T12:00:00+00:00",
        nitrogenReductionT: 222,
        nitrogenReductionTOverridden: true,
        extractionEffortHa: 0.04,
        extractionEffortHaOverridden: false,
        afforestationEffortHa: null,
        afforestationEffortHaOverridden: false,
        areaHa: 144.01229085892314,
        f2FormUrl: null,
        latestSnapshot: {
          stateNr: 6,
          geoLocationId: "4a8dfbc0-d4c5-478b-b3cf-d74197fc3383",
          areaHa: 106.74059136033318,
          nitrogenReductionT: 222,
          extractionEffortHa: 0.04,
          afforestationEffortHa: null,
          created: "2025-05-15T04:21:46.500189+00:00",
        },
        creator: {
          user: {
            id: "f273168c-4a3b-4917-a457-0a4d5f7233e2",
            name: "USa_MST_ MARS_Planlægger",
          },
          organization: {
            id: "5e252de1-f4ad-45be-9948-860c3a91c82e",
            name: "Miljøstyrelsen",
            vat: "DK25798376",
          },
        },
        owner: {
          user: null,
          organization: {
            id: "5e252de1-f4ad-45be-9948-860c3a91c82e",
            name: "Miljøstyrelsen",
            vat: "DK25798376",
          },
        },
        created: "2025-05-14T07:26:49.052926+00:00",
        updated: "2025-07-17T07:38:56.437183+00:00",
        lastStateChanged: "2025-05-14T07:31:24.776127+00:00",

        // Extra properties for the map
        geometryWkt:
          "MULTIPOLYGON (((536848.5353188185 6346864.170815518, 535613.6147526584 6347336.0288243815, 536478.9213975612 6348476.804757819, 537180.4315420579 6348292.5509164715, 536848.5353188185 6346864.170815518)))",
        snapshotGeometryWkt:
          "MULTIPOLYGON (((536618.7629581506 6347131.985142916, 535899.5790435629 6347431.573652884, 536478.9213975612 6348476.804757819, 537138.1733192666 6348110.641003096, 536618.7629581506 6347131.985142916)))",

        linkToProject:
          "https://mars.udv.sgav.dk/projects/402a966e-6d9f-41ff-9bda-23cc55ba5d76",
      };

      const mitigationMeasures = [
        {
          id: "1076fbc9-5ab9-4236-86ed-7d7cc51a2292",
          name: "Minivådområder",
          nitrogenReductionFactor: 472,
          nitrogenReductionDependsOnRetention: false,
          extractionEffortFactor: 0,
          extractionEffortDependsOnCarbon: false,
          afforestationEffortFactor: 0,
          icon: '<svg width="22" height="20" viewBox="0 0 22 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.38358 8.6665H6.78057C6.68726 8.26137 6.55645 7.87222 6.38815 7.49904C6.8273 6.78413 7.41556 6.20392 8.15293 5.7584C8.89029 5.31288 9.70838 5.07976 10.6072 5.05903C10.8581 5.04867 10.9888 5.12907 10.9993 5.30024C11.0097 5.4714 10.9104 5.61376 10.7013 5.72731C10.1262 6.05887 9.63477 6.48884 9.22698 7.01725C8.84485 7.51241 8.56372 8.06216 8.38358 8.6665Z" fill="currentColor"/><path d="M2.98113 8.6665H5.50514C5.28704 7.87108 4.86764 7.16074 4.24694 6.53547C3.29042 5.5719 2.12728 5.07976 0.757529 5.05903C0.48567 5.04909 0.344512 5.12431 0.334056 5.2847C0.3236 5.44508 0.433389 5.59262 0.663424 5.72731C1.23851 6.05887 1.72995 6.48884 2.13774 7.01725C2.51987 7.51241 2.801 8.06216 2.98113 8.6665Z" fill="currentColor"/><path d="M6.63156 3.38802C5.99876 4.24301 5.68236 5.21963 5.68236 6.31789C5.98517 5.92459 6.3275 5.56983 6.70936 5.25361C7.09122 4.9374 7.51218 4.6705 7.97225 4.45292C8.13996 4.01776 8.34658 3.6085 8.59209 3.22515C8.83759 2.84179 9.12765 2.4947 9.46224 2.18387C9.67137 1.98702 9.71842 1.82124 9.6034 1.68655C9.48838 1.55186 9.31063 1.52595 9.07014 1.60884C8.07723 1.93998 7.26437 2.53304 6.63156 3.38802Z" fill="currentColor"/><path d="M4.16099 4.88808C4.28647 4.97097 4.41194 5.05903 4.53741 5.15228C4.60015 4.79006 4.69948 4.43531 4.83541 4.08801C4.97134 3.74071 5.13341 3.41164 5.32162 3.10082C5.14429 2.64494 4.91174 2.22532 4.62399 1.84196C4.33624 1.45861 4.00415 1.1167 3.62773 0.816229C3.41903 0.650868 3.24922 0.622479 3.11831 0.731062C2.9874 0.839645 2.97945 1.00791 3.09447 1.23585C3.32492 1.70209 3.50017 2.18387 3.6202 2.6812C3.74024 3.17852 3.80026 3.70175 3.80026 4.25088C3.80026 4.31346 3.79503 4.37832 3.78457 4.44546C3.77412 4.5126 3.76889 4.57725 3.76889 4.63942C3.90482 4.7223 4.03552 4.80519 4.16099 4.88808Z" fill="currentColor"/><path d="M19.7044 9.33317H18.5021C18.4321 9.02932 18.334 8.73745 18.2078 8.45757C18.5372 7.92139 18.9783 7.48623 19.5314 7.15209C20.0844 6.81795 20.698 6.64311 21.3721 6.62757C21.5603 6.6198 21.6583 6.6801 21.6661 6.80847C21.674 6.93684 21.5995 7.04361 21.4426 7.12878C21.0113 7.37744 20.6428 7.69993 20.3369 8.09623C20.0503 8.4676 19.8395 8.87992 19.7044 9.33317Z" fill="currentColor"/><path d="M15.6525 9.33317H17.5455C17.382 8.7366 17.0674 8.20385 16.6019 7.73489C15.8845 7.01222 15.0121 6.64311 13.9848 6.62757C13.7809 6.62011 13.6751 6.67652 13.6672 6.79681C13.6594 6.91711 13.7417 7.02776 13.9142 7.12878C14.3456 7.37744 14.7141 7.69993 15.02 8.09623C15.3066 8.4676 15.5174 8.87992 15.6525 9.33317Z" fill="currentColor"/><path d="M18.3903 5.37431C17.9157 6.01555 17.6784 6.74801 17.6784 7.57171C17.9056 7.27673 18.1623 7.01066 18.4487 6.7735C18.7351 6.53634 19.0508 6.33617 19.3959 6.17298C19.5216 5.84661 19.6766 5.53967 19.8607 5.25215C20.0449 4.96464 20.2624 4.70432 20.5134 4.4712C20.6702 4.32355 20.7055 4.19922 20.6192 4.0982C20.533 3.99718 20.3996 3.97776 20.2193 4.03992C19.4746 4.28828 18.865 4.73307 18.3903 5.37431Z" fill="currentColor"/><path d="M16.5374 6.49935C16.6315 6.56152 16.7256 6.62757 16.8197 6.6975C16.8668 6.42584 16.9413 6.15977 17.0432 5.8993C17.1452 5.63882 17.2667 5.39203 17.4079 5.15891C17.2749 4.81699 17.1005 4.50228 16.8847 4.21476C16.6689 3.92725 16.4198 3.67081 16.1375 3.44546C15.9809 3.32144 15.8536 3.30015 15.7554 3.38159C15.6572 3.46303 15.6513 3.58922 15.7375 3.76018C15.9104 4.10986 16.0418 4.4712 16.1318 4.84419C16.2219 5.21719 16.2669 5.60961 16.2669 6.02145C16.2669 6.06839 16.2629 6.11703 16.2551 6.16739C16.2473 6.21774 16.2433 6.26623 16.2433 6.31285C16.3453 6.37502 16.4433 6.43719 16.5374 6.49935Z" fill="currentColor"/><path d="M3.88004 18.4443C3.38226 18.4443 3.0132 18.537 2.77284 18.7225C2.53249 18.908 2.20822 19.0375 1.80004 19.1109C1.39187 19.1844 1.0452 19.1512 0.760043 19.0114C0.474888 18.8715 0.332666 18.6603 0.333377 18.3776C0.333377 18.1554 0.448932 17.9406 0.680043 17.7332C0.911154 17.5258 1.2756 17.3184 1.77338 17.1109C1.86227 17.0665 2.098 16.9815 2.48058 16.8558C2.86315 16.7302 3.3652 16.6671 3.98671 16.6665C4.96449 16.6665 5.62226 16.8147 5.96004 17.1109C6.29782 17.4072 6.7956 17.5554 7.45338 17.5554C8.11115 17.5554 8.60466 17.4072 8.93391 17.1109C9.26315 16.8147 9.94298 16.6665 10.9734 16.6665C12.0038 16.6665 12.7017 16.8147 13.0672 17.1109C13.4328 17.4072 13.9348 17.5554 14.5734 17.5554C15.212 17.5554 15.692 17.4072 16.0134 17.1109C16.3348 16.8147 16.9926 16.6665 17.9867 16.6665C18.6089 16.6665 19.1113 16.7296 19.4939 16.8558C19.8765 16.9821 20.1119 17.0671 20.2 17.1109C20.7156 17.3332 21.0889 17.5444 21.32 17.7447C21.5511 17.945 21.6667 18.156 21.6667 18.3776C21.6667 18.6591 21.5199 18.8704 21.2262 19.0114C20.9325 19.1524 20.5816 19.1856 20.1734 19.1109C19.7652 19.0363 19.4452 18.9068 19.2134 18.7225C18.9816 18.5382 18.6171 18.4455 18.12 18.4443C17.4623 18.4443 16.9691 18.5924 16.6406 18.8887C16.312 19.185 15.6319 19.3332 14.6 19.3332C13.5682 19.3332 12.8703 19.185 12.5062 18.8887C12.1421 18.5924 11.6312 18.4443 10.9734 18.4443C10.3156 18.4443 9.83133 18.5924 9.52058 18.8887C9.20982 19.185 8.52964 19.3332 7.48004 19.3332C6.43044 19.3332 5.73249 19.185 5.38618 18.8887C5.03986 18.5924 4.53782 18.4443 3.88004 18.4443Z" fill="currentColor"/><path d="M3.88004 14.1109C3.38226 14.1109 3.0132 14.2037 2.77284 14.3892C2.53249 14.5747 2.20822 14.7041 1.80004 14.7776C1.39187 14.8511 1.0452 14.8179 0.760043 14.6781C0.474888 14.5382 0.332666 14.3269 0.333377 14.0443C0.333377 13.8221 0.448932 13.6072 0.680043 13.3998C0.911154 13.1924 1.2756 12.985 1.77338 12.7776C1.86227 12.7332 2.098 12.6481 2.48058 12.5225C2.86315 12.3969 3.3652 12.3338 3.98671 12.3332C4.96449 12.3332 5.62226 12.4813 5.96004 12.7776C6.29782 13.0739 6.7956 13.2221 7.45338 13.2221C8.11115 13.2221 8.60466 13.0739 8.93391 12.7776C9.26315 12.4813 9.94298 12.3332 10.9734 12.3332C12.0038 12.3332 12.7017 12.4813 13.0672 12.7776C13.4328 13.0739 13.9348 13.2221 14.5734 13.2221C15.212 13.2221 15.692 13.0739 16.0134 12.7776C16.3348 12.4813 16.9926 12.3332 17.9867 12.3332C18.6089 12.3332 19.1113 12.3963 19.4939 12.5225C19.8765 12.6487 20.1119 12.7338 20.2 12.7776C20.7156 12.9998 21.0889 13.2111 21.32 13.4114C21.5511 13.6117 21.6667 13.8227 21.6667 14.0443C21.6667 14.3258 21.5199 14.537 21.2262 14.6781C20.9325 14.8191 20.5816 14.8523 20.1734 14.7776C19.7652 14.7029 19.4452 14.5735 19.2134 14.3892C18.9816 14.2049 18.6171 14.1121 18.12 14.1109C17.4623 14.1109 16.9691 14.2591 16.6406 14.5554C16.312 14.8517 15.6319 14.9998 14.6 14.9998C13.5682 14.9998 12.8703 14.8517 12.5062 14.5554C12.1421 14.2591 11.6312 14.1109 10.9734 14.1109C10.3156 14.1109 9.83133 14.2591 9.52058 14.5554C9.20982 14.8517 8.52964 14.9998 7.48004 14.9998C6.43044 14.9998 5.73249 14.8517 5.38618 14.5554C5.03986 14.2591 4.53782 14.1109 3.88004 14.1109Z" fill="currentColor"/></svg>',
          color: "rgba(0, 104, 137, 1)",
        },
        {
          id: "72688c3e-2616-48a3-b1a1-8869f12c5ec1",
          name: "Øvrige",
          nitrogenReductionFactor: 41,
          nitrogenReductionDependsOnRetention: true,
          extractionEffortFactor: 1,
          extractionEffortDependsOnCarbon: true,
          afforestationEffortFactor: 0,
          icon: '<svg width="22" height="21" viewBox="0 0 22 21" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.33337 2.00016C8.09379 2.00016 7.86462 2.05016 7.65837 2.14183C7.56254 1.12725 6.70629 0.333496 5.66671 0.333496C4.62712 0.333496 3.77087 1.12725 3.67504 2.14183C3.46879 2.05016 3.23962 2.00016 3.00004 2.00016C2.07921 2.00016 1.33337 2.746 1.33337 3.66683C1.33337 3.96683 1.41254 4.24808 1.55212 4.49183C0.835457 4.796 0.333374 5.50641 0.333374 6.3335C0.333374 7.43766 1.22921 8.3335 2.33337 8.3335H5.00004V10.3335C5.00004 10.7022 5.29796 11.0002 5.66671 11.0002C6.03546 11.0002 6.33337 10.7022 6.33337 10.3335V8.3335H9.00004C10.1042 8.3335 11 7.43766 11 6.3335C11 5.50641 10.498 4.796 9.78129 4.49183C9.92087 4.24808 10 3.96683 10 3.66683C10 2.746 9.25421 2.00016 8.33337 2.00016Z" fill="currentColor"/><path d="M19.7044 9.00016H18.5021C18.4321 8.69631 18.334 8.40445 18.2078 8.12456C18.5372 7.58838 18.9783 7.15322 19.5314 6.81908C20.0844 6.48494 20.698 6.3101 21.3721 6.29456C21.5603 6.28679 21.6583 6.34709 21.6661 6.47546C21.674 6.60383 21.5995 6.7106 21.4426 6.79577C21.0113 7.04443 20.6428 7.36692 20.3369 7.76322C20.0503 8.13459 19.8395 8.54691 19.7044 9.00016Z" fill="currentColor"/><path d="M15.6525 9.00016H17.5455C17.382 8.4036 17.0674 7.87084 16.6019 7.40189C15.8845 6.67921 15.0121 6.3101 13.9848 6.29456C13.7809 6.2871 13.6751 6.34352 13.6672 6.46381C13.6594 6.5841 13.7417 6.69475 13.9142 6.79577C14.3456 7.04443 14.7141 7.36692 15.02 7.76322C15.3066 8.13459 15.5174 8.54691 15.6525 9.00016Z" fill="currentColor"/><path d="M18.3903 5.0413C17.9157 5.68254 17.6784 6.41501 17.6784 7.2387C17.9056 6.94373 18.1623 6.67766 18.4487 6.44049C18.7351 6.20333 19.0508 6.00316 19.3959 5.83997C19.5216 5.5136 19.6766 5.20666 19.8607 4.91915C20.0449 4.63163 20.2624 4.37131 20.5134 4.13819C20.6702 3.99055 20.7055 3.86622 20.6192 3.7652C20.533 3.66418 20.3996 3.64475 20.2193 3.70692C19.4746 3.95527 18.865 4.40006 18.3903 5.0413Z" fill="currentColor"/><path d="M16.5374 6.16634C16.6315 6.22851 16.7256 6.29456 16.8197 6.3645C16.8668 6.09283 16.9413 5.82676 17.0432 5.56629C17.1452 5.30582 17.2667 5.05902 17.4079 4.8259C17.2749 4.48399 17.1005 4.16927 16.8847 3.88176C16.6689 3.59424 16.4198 3.33781 16.1375 3.11246C15.9809 2.98844 15.8536 2.96714 15.7554 3.04858C15.6572 3.13002 15.6513 3.25621 15.7375 3.42717C15.9104 3.77685 16.0418 4.13819 16.1318 4.51118C16.2219 4.88418 16.2669 5.2766 16.2669 5.68845C16.2669 5.73538 16.2629 5.78403 16.2551 5.83438C16.2473 5.88473 16.2433 5.93322 16.2433 5.97985C16.3453 6.04201 16.4433 6.10418 16.5374 6.16634Z" fill="currentColor"/><path d="M3.88004 19.4446C3.38226 19.4446 3.0132 19.5373 2.77284 19.7228C2.53249 19.9083 2.20822 20.0378 1.80004 20.1113C1.39187 20.1848 1.0452 20.1516 0.760043 20.0117C0.474888 19.8719 0.332666 19.6606 0.333377 19.3779C0.333377 19.1557 0.448932 18.9409 0.680043 18.7335C0.911154 18.5261 1.2756 18.3187 1.77338 18.1113C1.86227 18.0668 2.098 17.9818 2.48058 17.8562C2.86315 17.7305 3.3652 17.6674 3.98671 17.6668C4.96449 17.6668 5.62226 17.815 5.96004 18.1113C6.29782 18.4076 6.7956 18.5557 7.45338 18.5557C8.11115 18.5557 8.60466 18.4076 8.93391 18.1113C9.26315 17.815 9.94298 17.6668 10.9734 17.6668C12.0038 17.6668 12.7017 17.815 13.0672 18.1113C13.4328 18.4076 13.9348 18.5557 14.5734 18.5557C15.212 18.5557 15.692 18.4076 16.0134 18.1113C16.3348 17.815 16.9926 17.6668 17.9867 17.6668C18.6089 17.6668 19.1113 17.7299 19.4939 17.8562C19.8765 17.9824 20.1119 18.0674 20.2 18.1113C20.7156 18.3335 21.0889 18.5448 21.32 18.7451C21.5511 18.9453 21.6667 19.1563 21.6667 19.3779C21.6667 19.6594 21.5199 19.8707 21.2262 20.0117C20.9325 20.1528 20.5816 20.1859 20.1734 20.1113C19.7652 20.0366 19.4452 19.9071 19.2134 19.7228C18.9816 19.5385 18.6171 19.4458 18.12 19.4446C17.4623 19.4446 16.9691 19.5928 16.6406 19.8891C16.312 20.1853 15.6319 20.3335 14.6 20.3335C13.5682 20.3335 12.8703 20.1853 12.5062 19.8891C12.1421 19.5928 11.6312 19.4446 10.9734 19.4446C10.3156 19.4446 9.83133 19.5928 9.52058 19.8891C9.20982 20.1853 8.52964 20.3335 7.48004 20.3335C6.43044 20.3335 5.73249 20.1853 5.38618 19.8891C5.03986 19.5928 4.53782 19.4446 3.88004 19.4446Z" fill="currentColor"/><path d="M3.88004 15.1113C3.38226 15.1113 3.0132 15.204 2.77284 15.3895C2.53249 15.575 2.20822 15.7045 1.80004 15.7779C1.39187 15.8514 1.0452 15.8182 0.760043 15.6784C0.474888 15.5385 0.332666 15.3273 0.333377 15.0446C0.333377 14.8224 0.448932 14.6076 0.680043 14.4002C0.911154 14.1928 1.2756 13.9853 1.77338 13.7779C1.86227 13.7335 2.098 13.6485 2.48058 13.5228C2.86315 13.3972 3.3652 13.3341 3.98671 13.3335C4.96449 13.3335 5.62226 13.4816 5.96004 13.7779C6.29782 14.0742 6.7956 14.2224 7.45338 14.2224C8.11115 14.2224 8.60466 14.0742 8.93391 13.7779C9.26315 13.4816 9.94298 13.3335 10.9734 13.3335C12.0038 13.3335 12.7017 13.4816 13.0672 13.7779C13.4328 14.0742 13.9348 14.2224 14.5734 14.2224C15.212 14.2224 15.692 14.0742 16.0134 13.7779C16.3348 13.4816 16.9926 13.3335 17.9867 13.3335C18.6089 13.3335 19.1113 13.3966 19.4939 13.5228C19.8765 13.6491 20.1119 13.7341 20.2 13.7779C20.7156 14.0002 21.0889 14.2114 21.32 14.4117C21.5511 14.612 21.6667 14.823 21.6667 15.0446C21.6667 15.3261 21.5199 15.5373 21.2262 15.6784C20.9325 15.8194 20.5816 15.8526 20.1734 15.7779C19.7652 15.7033 19.4452 15.5738 19.2134 15.3895C18.9816 15.2052 18.6171 15.1125 18.12 15.1113C17.4623 15.1113 16.9691 15.2594 16.6406 15.5557C16.312 15.852 15.6319 16.0002 14.6 16.0002C13.5682 16.0002 12.8703 15.852 12.5062 15.5557C12.1421 15.2594 11.6312 15.1113 10.9734 15.1113C10.3156 15.1113 9.83133 15.2594 9.52058 15.5557C9.20982 15.852 8.52964 16.0002 7.48004 16.0002C6.43044 16.0002 5.73249 15.852 5.38618 15.5557C5.03986 15.2594 4.53782 15.1113 3.88004 15.1113Z" fill="currentColor"/></svg>',
          color: "rgba(45, 13, 124, 1)",
        },
        {
          id: "9d4b932e-c6d6-4550-984f-6623601894c6",
          name: "Ekstensivering",
          nitrogenReductionFactor: 41,
          nitrogenReductionDependsOnRetention: true,
          extractionEffortFactor: 1,
          extractionEffortDependsOnCarbon: true,
          afforestationEffortFactor: 0,
          icon: '<svg width="22" height="21" viewBox="0 0 22 21" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.841 20.3088C11.7291 20.4767 11.5549 20.5934 11.3569 20.6331C11.1588 20.6729 10.953 20.6325 10.7848 20.5208C7.91449 18.6147 4.54271 17.6003 1.09528 17.6059C0.893209 17.6059 0.699416 17.5258 0.556531 17.3831C0.413646 17.2405 0.333374 17.047 0.333374 16.8453C0.333374 16.6436 0.413646 16.4501 0.556531 16.3075C0.699416 16.1649 0.893209 16.0847 1.09528 16.0847C4.84303 16.079 8.50844 17.182 11.6286 19.2544C11.7968 19.3662 11.9137 19.54 11.9535 19.7377C11.9933 19.9354 11.9529 20.1409 11.841 20.3088ZM1.09528 13.0424C0.893209 13.0424 0.699416 13.1225 0.556531 13.2652C0.413646 13.4078 0.333374 13.6013 0.333374 13.803C0.333374 14.0047 0.413646 14.1982 0.556531 14.3408C0.699416 14.4834 0.893209 14.5636 1.09528 14.5636C6.48085 14.5512 11.6541 16.6593 15.4924 20.4305C15.5632 20.5032 15.6479 20.561 15.7414 20.6006C15.8349 20.6401 15.9354 20.6606 16.037 20.6608C16.1386 20.661 16.2392 20.641 16.3329 20.6018C16.4266 20.5627 16.5115 20.5052 16.5826 20.4328C16.6537 20.3604 16.7096 20.2746 16.747 20.1803C16.7844 20.086 16.8026 19.9852 16.8004 19.8838C16.7982 19.7825 16.7757 19.6826 16.7343 19.59C16.6928 19.4974 16.6333 19.414 16.5591 19.3448C12.4366 15.2937 6.88 13.0291 1.09528 13.0424Z" fill="currentColor"/><path d="M20.9048 14.5636C19.3475 14.5625 17.795 14.7376 16.2772 15.0855C16.8004 15.4817 17.3083 15.8987 17.801 16.3367C18.8271 16.1689 19.8651 16.0846 20.9048 16.0847C21.1069 16.0847 21.3007 16.1649 21.4436 16.3075C21.5864 16.4501 21.6667 16.6436 21.6667 16.8453C21.6667 17.047 21.5864 17.2405 21.4436 17.3831C21.3007 17.5258 21.1069 17.6059 20.9048 17.6059C20.3334 17.6059 19.7686 17.6335 19.2048 17.6877C19.7331 18.2372 20.2391 18.812 20.7229 19.4123C20.7892 19.4897 20.8392 19.5797 20.8699 19.6769C20.9007 19.774 20.9116 19.8763 20.902 19.9778C20.8924 20.0792 20.8625 20.1776 20.814 20.2673C20.7656 20.357 20.6996 20.436 20.6199 20.4997C20.5403 20.5634 20.4486 20.6105 20.3504 20.6382C20.2522 20.6658 20.1494 20.6735 20.0481 20.6608C19.9469 20.648 19.8492 20.6151 19.761 20.5639C19.6727 20.5128 19.5956 20.4445 19.5343 20.363C17.326 17.5985 14.5207 15.3676 11.3279 13.8366C8.13517 12.3056 4.63729 11.5141 1.09528 11.5212C0.893209 11.5212 0.699416 11.4411 0.556531 11.2985C0.413646 11.1558 0.333374 10.9624 0.333374 10.7607C0.333374 10.5589 0.413646 10.3655 0.556531 10.2229C0.699416 10.0802 0.893209 10.0001 1.09528 10.0001C2.62854 10.0003 4.15861 10.1394 5.66671 10.4155L7.19052 10.7426C7.96448 10.9327 8.72639 11.1603 9.47623 11.4252L11.0067 12.0223C11.9961 11.5982 13.0118 11.2384 14.0477 10.9451L15.5715 10.5648C16.3258 10.4026 17.0877 10.2758 17.8572 10.1845L19.381 10.0467C19.8867 10.0172 20.3943 10.0001 20.9048 10.0001C21.1069 10.0001 21.3007 10.0802 21.4436 10.2229C21.5864 10.3655 21.6667 10.5589 21.6667 10.7607C21.6667 10.9624 21.5864 11.1558 21.4436 11.2985C21.3007 11.4411 21.1069 11.5212 20.9048 11.5212C18.1688 11.516 15.4529 11.9887 12.88 12.9179C13.4794 13.2348 14.0654 13.5764 14.6381 13.9427C16.673 13.3441 18.7835 13.0409 20.9048 13.0424C21.1069 13.0424 21.3007 13.1225 21.4436 13.2652C21.5864 13.4078 21.6667 13.6013 21.6667 13.803C21.6667 14.0047 21.5864 14.1982 21.4436 14.3408C21.3007 14.4834 21.1069 14.5636 20.9048 14.5636Z" fill="currentColor"/><path d="M11 2.33341C10.7605 2.33341 10.5313 2.38341 10.325 2.47508C10.2292 1.4605 9.37296 0.666748 8.33337 0.666748C7.29379 0.666748 6.43754 1.4605 6.34171 2.47508C6.13546 2.38341 5.90629 2.33341 5.66671 2.33341C4.74587 2.33341 4.00004 3.07925 4.00004 4.00008C4.00004 4.30008 4.07921 4.58133 4.21879 4.82508C3.50212 5.12925 3.00004 5.83966 3.00004 6.66675C3.00004 7.77092 3.89587 8.66675 5.00004 8.66675H7.66671V10.6667C7.66671 11.0355 7.96462 11.3334 8.33337 11.3334C8.70212 11.3334 9.00004 11.0355 9.00004 10.6667V8.66675H11.6667C12.7709 8.66675 13.6667 7.77092 13.6667 6.66675C13.6667 5.83966 13.1646 5.12925 12.448 4.82508C12.5875 4.58133 12.6667 4.30008 12.6667 4.00008C12.6667 3.07925 11.9209 2.33341 11 2.33341Z" fill="currentColor"/></svg>',
          color: "rgba(246, 125, 13, 1)",
        },
        {
          id: "85bffbd9-fc34-41b8-8302-df2fb124f394",
          name: "Kvælstofvådområder",
          nitrogenReductionFactor: 90,
          nitrogenReductionDependsOnRetention: false,
          extractionEffortFactor: 1,
          extractionEffortDependsOnCarbon: true,
          afforestationEffortFactor: 0,
          icon: '<svg width="22" height="20" viewBox="0 0 22 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.88004 18.4443C3.38226 18.4443 3.0132 18.537 2.77284 18.7225C2.53249 18.908 2.20822 19.0375 1.80004 19.1109C1.39187 19.1844 1.0452 19.1512 0.760043 19.0114C0.474888 18.8715 0.332666 18.6603 0.333377 18.3776C0.333377 18.1554 0.448932 17.9406 0.680043 17.7332C0.911154 17.5258 1.2756 17.3184 1.77338 17.1109C1.86227 17.0665 2.098 16.9815 2.48058 16.8558C2.86315 16.7302 3.3652 16.6671 3.98671 16.6665C4.96449 16.6665 5.62226 16.8147 5.96004 17.1109C6.29782 17.4072 6.7956 17.5554 7.45338 17.5554C8.11115 17.5554 8.60466 17.4072 8.93391 17.1109C9.26315 16.8147 9.94298 16.6665 10.9734 16.6665C12.0038 16.6665 12.7017 16.8147 13.0672 17.1109C13.4328 17.4072 13.9348 17.5554 14.5734 17.5554C15.212 17.5554 15.692 17.4072 16.0134 17.1109C16.3348 16.8147 16.9926 16.6665 17.9867 16.6665C18.6089 16.6665 19.1113 16.7296 19.4939 16.8558C19.8765 16.9821 20.1119 17.0671 20.2 17.1109C20.7156 17.3332 21.0889 17.5444 21.32 17.7447C21.5511 17.945 21.6667 18.156 21.6667 18.3776C21.6667 18.6591 21.5199 18.8704 21.2262 19.0114C20.9325 19.1524 20.5816 19.1856 20.1734 19.1109C19.7652 19.0363 19.4452 18.9068 19.2134 18.7225C18.9816 18.5382 18.6171 18.4455 18.12 18.4443C17.4623 18.4443 16.9691 18.5924 16.6406 18.8887C16.312 19.185 15.6319 19.3332 14.6 19.3332C13.5682 19.3332 12.8703 19.185 12.5062 18.8887C12.1421 18.5924 11.6312 18.4443 10.9734 18.4443C10.3156 18.4443 9.83133 18.5924 9.52058 18.8887C9.20982 19.185 8.52964 19.3332 7.48004 19.3332C6.43044 19.3332 5.73249 19.185 5.38618 18.8887C5.03986 18.5924 4.53782 18.4443 3.88004 18.4443Z" fill="currentColor"/><path d="M3.88004 14.1109C3.38226 14.1109 3.0132 14.2037 2.77284 14.3892C2.53249 14.5747 2.20822 14.7041 1.80004 14.7776C1.39187 14.8511 1.0452 14.8179 0.760043 14.6781C0.474888 14.5382 0.332666 14.3269 0.333377 14.0443C0.333377 13.8221 0.448932 13.6072 0.680043 13.3998C0.911154 13.1924 1.2756 12.985 1.77338 12.7776C1.86227 12.7332 2.098 12.6481 2.48058 12.5225C2.86315 12.3969 3.3652 12.3338 3.98671 12.3332C4.96449 12.3332 5.62226 12.4813 5.96004 12.7776C6.29782 13.0739 6.7956 13.2221 7.45338 13.2221C8.11115 13.2221 8.60466 13.0739 8.93391 12.7776C9.26315 12.4813 9.94298 12.3332 10.9734 12.3332C12.0038 12.3332 12.7017 12.4813 13.0672 12.7776C13.4328 13.0739 13.9348 13.2221 14.5734 13.2221C15.212 13.2221 15.692 13.0739 16.0134 12.7776C16.3348 12.4813 16.9926 12.3332 17.9867 12.3332C18.6089 12.3332 19.1113 12.3963 19.4939 12.5225C19.8765 12.6487 20.1119 12.7338 20.2 12.7776C20.7156 12.9998 21.0889 13.2111 21.32 13.4114C21.5511 13.6117 21.6667 13.8227 21.6667 14.0443C21.6667 14.3258 21.5199 14.537 21.2262 14.6781C20.9325 14.8191 20.5816 14.8523 20.1734 14.7776C19.7652 14.7029 19.4452 14.5735 19.2134 14.3892C18.9816 14.2049 18.6171 14.1121 18.12 14.1109C17.4623 14.1109 16.9691 14.2591 16.6406 14.5554C16.312 14.8517 15.6319 14.9998 14.6 14.9998C13.5682 14.9998 12.8703 14.8517 12.5062 14.5554C12.1421 14.2591 11.6312 14.1109 10.9734 14.1109C10.3156 14.1109 9.83133 14.2591 9.52058 14.5554C9.20982 14.8517 8.52964 14.9998 7.48004 14.9998C6.43044 14.9998 5.73249 14.8517 5.38618 14.5554C5.03986 14.2591 4.53782 14.1109 3.88004 14.1109Z" fill="currentColor"/><path d="M14.3961 10.6665H12.3924C12.2757 10.1601 12.1122 9.67364 11.9018 9.20717C12.4508 8.31354 13.1861 7.58827 14.1078 7.03137C15.0295 6.47447 16.0521 6.18307 17.1756 6.15717C17.4893 6.14422 17.6527 6.24472 17.6658 6.45867C17.6788 6.67262 17.5547 6.85057 17.2933 6.99252C16.5744 7.40696 15.9601 7.94443 15.4504 8.60494C14.9727 9.22389 14.6213 9.91108 14.3961 10.6665Z" fill="currentColor"/><path d="M7.64307 10.6665H10.7981C10.5255 9.67223 10.0012 8.7843 9.22534 8.00271C8.02968 6.79825 6.57576 6.18307 4.86357 6.15717C4.52374 6.14473 4.3473 6.23876 4.33423 6.43924C4.32116 6.63973 4.45839 6.82415 4.74594 6.99252C5.46479 7.40696 6.07909 7.94443 6.58883 8.60494C7.06649 9.22389 7.4179 9.91108 7.64307 10.6665Z" fill="currentColor"/><path d="M12.2061 4.0684C11.4151 5.13713 11.0196 6.35791 11.0196 7.73073C11.3981 7.23911 11.826 6.79566 12.3034 6.40039C12.7807 6.00512 13.3069 5.6715 13.882 5.39952C14.0916 4.85557 14.3499 4.344 14.6568 3.86481C14.9637 3.38562 15.3262 2.95175 15.7445 2.56322C16.0059 2.31714 16.0647 2.10992 15.9209 1.94156C15.7771 1.77319 15.5549 1.74082 15.2543 1.84443C14.0132 2.25834 12.9971 2.99967 12.2061 4.0684Z" fill="currentColor"/><path d="M9.1179 5.94347C9.27474 6.04708 9.43158 6.15717 9.58842 6.27373C9.66685 5.82095 9.79101 5.37751 9.96092 4.94338C10.1308 4.50926 10.3334 4.09793 10.5687 3.70939C10.347 3.13954 10.0563 2.61502 9.69664 2.13583C9.33695 1.65663 8.92185 1.22924 8.45132 0.85366C8.19044 0.64696 7.97818 0.611473 7.81454 0.747202C7.65091 0.88293 7.64097 1.09326 7.78474 1.37818C8.07281 1.96099 8.29187 2.56322 8.44191 3.18487C8.59196 3.80653 8.66698 4.46056 8.66698 5.14698C8.66698 5.2252 8.66044 5.30627 8.64737 5.3902C8.6343 5.47412 8.62777 5.55494 8.62777 5.63264C8.79768 5.73625 8.96106 5.83986 9.1179 5.94347Z" fill="currentColor"/></svg>',
          color: "rgba(3, 129, 121, 1)",
        },
        {
          id: "4d1bdb7a-ee68-46c1-9364-792ad26eb337",
          name: "Lavbundsprojekter",
          nitrogenReductionFactor: 40,
          nitrogenReductionDependsOnRetention: false,
          extractionEffortFactor: 1,
          extractionEffortDependsOnCarbon: false,
          afforestationEffortFactor: 0,
          icon: '<svg width="22" height="21" viewBox="0 0 22 21" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.0333 19.8209C20.0032 19.9251 19.9223 20.006 19.8182 20.0362L18.7904 20.3241C18.6835 20.3543 18.5657 20.3241 18.4876 20.246L17.7572 19.5151C17.6777 19.4356 17.6475 19.3204 17.6791 19.2121L17.9668 18.1837C17.997 18.0795 18.0778 17.9986 18.182 17.9684L19.2097 17.6805C19.3166 17.6503 19.4345 17.6805 19.5126 17.7586L20.243 18.4895C20.3224 18.569 20.3526 18.6842 20.3211 18.7925L20.0333 19.8209Z" fill="currentColor"/><path d="M14.8947 17.4503C15.051 17.4955 15.1724 17.6169 15.2176 17.7732L15.6495 19.3158C15.6948 19.4762 15.6495 19.6531 15.5323 19.7703L14.436 20.8666C14.3168 20.9859 14.144 21.0311 13.9815 20.9838L12.439 20.5519C12.2826 20.5067 12.1613 20.3853 12.1161 20.229L11.6841 18.6864C11.6389 18.526 11.6841 18.3491 11.8014 18.2319L12.8976 17.1356C13.0169 17.0163 13.1897 16.9711 13.3522 17.0184L14.8947 17.4503Z" fill="currentColor"/><path d="M2.04202 17.6457C2.07972 17.5154 2.18084 17.4143 2.3111 17.3766L3.59656 17.0167C3.73025 16.979 3.87765 17.0167 3.97535 17.1144L4.88888 18.0279C4.98829 18.1273 5.026 18.2713 4.98658 18.4067L4.62665 19.6922C4.58894 19.8225 4.48782 19.9236 4.35756 19.9613L3.0721 20.3212C2.93841 20.3589 2.79101 20.3212 2.69331 20.2235L1.77978 19.31C1.68037 19.2106 1.64267 19.0666 1.68209 18.9312L2.04202 17.6457Z" fill="currentColor"/><path d="M9.15218 17.9684C9.25639 17.9986 9.33729 18.0795 9.36745 18.1837L9.65539 19.2121C9.68556 19.3191 9.65539 19.437 9.57724 19.5151L8.84641 20.246C8.76688 20.3255 8.6517 20.3557 8.54338 20.3241L7.51502 20.0362C7.41081 20.006 7.32991 19.9251 7.29974 19.8209L7.0118 18.7925C6.98164 18.6856 7.0118 18.5676 7.08996 18.4895L7.82079 17.7586C7.90031 17.6791 8.01549 17.649 8.12381 17.6805L9.15218 17.9684Z" fill="currentColor"/><path d="M14.3961 10.3333H12.3924C12.2757 9.82684 12.1122 9.34039 11.9018 8.87392C12.4508 7.98029 13.1861 7.25502 14.1078 6.69812C15.0295 6.14122 16.0521 5.84982 17.1756 5.82391C17.4893 5.81096 17.6527 5.91146 17.6658 6.12542C17.6788 6.33937 17.5547 6.51732 17.2933 6.65926C16.5744 7.0737 15.9601 7.61118 15.4504 8.27169C14.9727 8.89064 14.6213 9.57783 14.3961 10.3333Z" fill="currentColor"/><path d="M7.64307 10.3333H10.7981C10.5255 9.33897 10.0012 8.45104 9.22534 7.66946C8.02968 6.465 6.57576 5.84982 4.86357 5.82391C4.52374 5.81148 4.3473 5.90551 4.33423 6.10599C4.32116 6.30648 4.45839 6.4909 4.74594 6.65926C5.46479 7.0737 6.07909 7.61118 6.58883 8.27169C7.06649 8.89064 7.4179 9.57783 7.64307 10.3333Z" fill="currentColor"/><path d="M12.2061 3.73515C11.4151 4.80388 11.0196 6.02466 11.0196 7.39748C11.3981 6.90586 11.826 6.46241 12.3034 6.06714C12.7807 5.67187 13.3069 5.33824 13.882 5.06627C14.0916 4.52232 14.3499 4.01075 14.6568 3.53156C14.9637 3.05236 15.3262 2.6185 15.7445 2.22996C16.0059 1.98389 16.0647 1.77667 15.9209 1.60831C15.7771 1.43994 15.5549 1.40756 15.2543 1.51117C14.0132 1.92509 12.9971 2.66642 12.2061 3.73515Z" fill="currentColor"/><path d="M9.1179 5.61022C9.27474 5.71383 9.43158 5.82391 9.58842 5.94047C9.66684 5.4877 9.79101 5.04425 9.96092 4.61013C10.1308 4.17601 10.3334 3.76468 10.5687 3.37614C10.347 2.80629 10.0563 2.28177 9.69664 1.80257C9.33695 1.32338 8.92185 0.895992 8.45132 0.520408C8.19044 0.313708 7.97818 0.278221 7.81454 0.41395C7.65091 0.549678 7.64097 0.760005 7.78474 1.04493C8.07281 1.62773 8.29187 2.22996 8.44191 2.85162C8.59196 3.47328 8.66698 4.12731 8.66698 4.81372C8.66698 4.89195 8.66044 4.97302 8.64737 5.05695C8.6343 5.14087 8.62777 5.22168 8.62777 5.29939C8.79768 5.403 8.96106 5.50661 9.1179 5.61022Z" fill="currentColor"/><path d="M3.88004 13.7777C3.38226 13.7777 3.0132 13.8704 2.77284 14.0559C2.53249 14.2414 2.20822 14.3709 1.80004 14.4444C1.39187 14.5178 1.0452 14.4847 0.760043 14.3448C0.474888 14.205 0.332666 13.9937 0.333377 13.711C0.333377 13.4888 0.448932 13.274 0.680043 13.0666C0.911154 12.8592 1.2756 12.6518 1.77338 12.4444C1.86227 12.3999 2.098 12.3149 2.48058 12.1893C2.86315 12.0636 3.3652 12.0005 3.98671 11.9999C4.96449 11.9999 5.62226 12.1481 5.96004 12.4444C6.29782 12.7407 6.7956 12.8888 7.45338 12.8888C8.11115 12.8888 8.60466 12.7407 8.93391 12.4444C9.26315 12.1481 9.94298 11.9999 10.9734 11.9999C12.0038 11.9999 12.7017 12.1481 13.0672 12.4444C13.4328 12.7407 13.9348 12.8888 14.5734 12.8888C15.212 12.8888 15.692 12.7407 16.0134 12.4444C16.3348 12.1481 16.9926 11.9999 17.9867 11.9999C18.6089 11.9999 19.1113 12.063 19.4939 12.1893C19.8765 12.3155 20.1119 12.4005 20.2 12.4444C20.7156 12.6666 21.0889 12.8778 21.32 13.0781C21.5511 13.2784 21.6667 13.4894 21.6667 13.711C21.6667 13.9925 21.5199 14.2038 21.2262 14.3448C20.9325 14.4858 20.5816 14.519 20.1734 14.4444C19.7652 14.3697 19.4452 14.2402 19.2134 14.0559C18.9816 13.8716 18.6171 13.7789 18.12 13.7777C17.4623 13.7777 16.9691 13.9258 16.6406 14.2221C16.312 14.5184 15.6319 14.6666 14.6 14.6666C13.5682 14.6666 12.8703 14.5184 12.5062 14.2221C12.1421 13.9258 11.6312 13.7777 10.9734 13.7777C10.3156 13.7777 9.83133 13.9258 9.52058 14.2221C9.20982 14.5184 8.52964 14.6666 7.48004 14.6666C6.43044 14.6666 5.73249 14.5184 5.38618 14.2221C5.03987 13.9258 4.53782 13.7777 3.88004 13.7777Z" fill="currentColor"/></svg>',
          color: "rgba(140, 61, 15, 1)",
        },
        {
          id: "dd264f93-915a-4df9-b94e-22190f9478e7",
          name: "Skovrejsning",
          nitrogenReductionFactor: 45,
          nitrogenReductionDependsOnRetention: true,
          extractionEffortFactor: 0,
          extractionEffortDependsOnCarbon: false,
          afforestationEffortFactor: 1,
          icon: '<svg width="28" height="22" viewBox="0 0 28 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.59163 5.39183L8.10413 0.575163C8.24996 0.420996 8.45413 0.333496 8.66663 0.333496C8.87913 0.333496 9.08329 0.420996 9.22913 0.575163L13.7416 5.39183C13.9083 5.571 14 5.80433 14 6.046C14 6.57516 13.5708 7.00016 13.0458 7.00016H12L15.1083 10.7293C15.2541 10.9043 15.3333 11.1252 15.3333 11.3543C15.3333 11.896 14.8958 12.3335 14.3541 12.3335H13.3333L16.4416 16.0627C16.5875 16.2377 16.6666 16.4585 16.6666 16.6877C16.6666 17.2293 16.2291 17.6668 15.6875 17.6668H9.99996V20.3335C9.99996 21.071 9.40413 21.6668 8.66663 21.6668C7.92913 21.6668 7.33329 21.071 7.33329 20.3335V17.6668H1.64579C1.10413 17.6668 0.666626 17.2293 0.666626 16.6877C0.666626 16.4585 0.745793 16.2377 0.891626 16.0627L3.99996 12.3335H2.97913C2.43746 12.3335 1.99996 11.896 1.99996 11.3543C1.99996 11.1252 2.07913 10.9043 2.22496 10.7293L5.33329 7.00016H4.28746C3.76246 7.00016 3.33329 6.571 3.33329 6.046C3.33329 5.80433 3.42496 5.571 3.59163 5.39183ZM14.9 4.7085L18.7708 0.575163C18.9166 0.420996 19.1208 0.333496 19.3333 0.333496C19.5458 0.333496 19.75 0.420996 19.8958 0.575163L24.4083 5.39183C24.575 5.571 24.6666 5.80433 24.6666 6.046C24.6666 6.57516 24.2375 7.00016 23.7125 7.00016H22.6666L25.775 10.7293C25.9208 10.9043 26 11.1252 26 11.3543C26 11.896 25.5625 12.3335 25.0208 12.3335H24L27.1083 16.0627C27.2541 16.2377 27.3333 16.4585 27.3333 16.6877C27.3333 17.2293 26.8958 17.6668 26.3541 17.6668H20.6666V20.3335C20.6666 21.071 20.0708 21.6668 19.3333 21.6668C18.5958 21.6668 18 21.071 18 20.3335V17.6668V16.6918V16.6877V16.6835V16.6668C17.9958 16.1335 17.8041 15.6168 17.4625 15.2085L15.7708 13.1793C16.3125 12.7543 16.6625 12.096 16.6625 11.3543C16.6625 10.8127 16.4708 10.2877 16.125 9.87516L14.4416 7.85433C14.9791 7.43766 15.3291 6.77933 15.3291 6.046C15.3291 5.56266 15.175 5.096 14.8958 4.7085H14.9Z" fill="currentColor"/></svg>',
          color: "rgba(0, 61, 35, 1)",
        },
      ];

      // Create a dictionary/map from mitigationMeasures array
      const mitigationMeasureMap = mitigationMeasures.reduce((map, measure) => {
        map[measure.id] = measure;
        return map;
      }, {});

      // Define EPSG:25832 projection (UTM Zone 32N, ETRS89)
      proj4.defs(
        "EPSG:25832",
        "+proj=utm +zone=32 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"
      );
      ol.proj.proj4.register(proj4);

      const mapZoomPaddingPx = 20; // Padding for zooming
      const extent = [230000, 6025000, 905000, 6450000]; // Map extent for Denmark in EPSG:25832

      // Function to load layers from data catalog
      async function loadLayersFromCatalog() {
        try {
          // Create layers from the catalog data using URLs from targetLayers
          const targetLayers = [
            "urn:dmp:ds:skaermkort-daempet",
            // 'urn:dmp:ds:ortofoto-foraar-nyeste-tilgaengelige'
          ];

          // Build params object
          const params = {
            include: [
              "thumbnail",
              "wfsSource",
              "wmsSource.legends.image",
              "wmtsSource.legends.image",
              "license",
              "dataLiabilityAgreement",
              "previewImages.image",
              "livePreviews.previewImage",
              "owners.thumbnail",
              "related",
              "tags",
              "category.thumbnail",
            ].join(","),
            filter: `any(id,${targetLayers
              .map((id) => `%27${encodeURIComponent(id)}%27`)
              .join(",")})`,
            locale: "da-DK",
            orgname: "MST",
            appname: "MARS",
            appurlname: encodeURIComponent("https://mars.sgav.dk"),
            componentname: encodeURIComponent("@dmp/map-components"),
          };

          // Build query string from params object
          const queryString = Object.entries(params)
            .map(([key, value]) => `${key}=${value}`)
            .join("&");

          const catalogUrl = `https://datakatalog.miljoeportal.dk/api/datasets?${queryString}`;

          const response = await fetch(catalogUrl, {
            method: "GET",
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          // Find WMS and WMTS sources in the included data
          const wmsSources =
            data.included?.filter((item) => item.type === "wmsSources") || [];
          const wmtsSources =
            data.included?.filter((item) => item.type === "wmtsSources") || [];

          targetLayers.forEach((layerId) => {
            console.log(`Processing layer: ${layerId}`);
            const dataset = data.data.find((item) => item.id === layerId);

            if (dataset) {
              console.log(`Found dataset: ${dataset.attributes.title}`);
              let layer = null;

              // Try to create WMTS layer first (faster)
              if (dataset.relationships?.wmtsSource?.data) {
                const wmtsSourceId = dataset.relationships.wmtsSource.data.id;
                const wmtsSource = wmtsSources.find(
                  (source) => source.id === wmtsSourceId
                );

                if (wmtsSource) {
                  try {
                    // Parse extent from the wmtsSource
                    const extentString = wmtsSource.attributes.extent;
                    let extent = null;
                    if (extentString) {
                      extent = extentString.split(",").map(Number);
                    }

                    layer = new ol.layer.Tile({
                      source: new ol.source.WMTS({
                        url: wmtsSource.attributes.url,
                        layer: wmtsSource.attributes.layer,
                        matrixSet: wmtsSource.attributes.matrixSet,
                        format: wmtsSource.attributes.format,
                        style: wmtsSource.attributes.style || "default",
                        tileGrid: new ol.tilegrid.WMTS({
                          origin: extent
                            ? [extent[0], extent[3]]
                            : [120000, 6500000], // Use extent or default
                          resolutions: wmtsSource.attributes.resolutions
                            .split(",")
                            .map(Number),
                          matrixIds: wmtsSource.attributes.matrixIds.split(","),
                          extent: extent,
                        }),
                      }),
                      visible: true,
                      opacity: 1.0,
                    });
                  } catch (wmtsError) {
                    console.error(
                      `Error creating WMTS layer: ${wmtsError.message}`
                    );
                  }
                }
              }

              // Fallback to WMS if WMTS is not available
              if (!layer && dataset.relationships?.wmsSource?.data) {
                const wmsSourceId = dataset.relationships.wmsSource.data.id;
                const wmsSource = wmsSources.find(
                  (source) => source.id === wmsSourceId
                );

                if (wmsSource) {
                  try {
                    layer = new ol.layer.Tile({
                      source: new ol.source.TileWMS({
                        url: wmsSource.attributes.url,
                        params: {
                          LAYERS: wmsSource.attributes.layer || layerId,
                          FORMAT: "image/png",
                          TRANSPARENT: true,
                          CRS: "EPSG:25832",
                        },
                        projection: "EPSG:25832",
                      }),
                      visible: true,
                      opacity: 1.0,
                    });
                  } catch (wmsError) {
                    console.error(
                      `Error creating WMS layer: ${wmsError.message}`
                    );
                  }
                }
              }

              // Add the layer to the map if created successfully
              if (layer) {
                map.addLayer(layer);
                console.log(
                  `Successfully added layer: ${dataset.attributes.title}`
                );
              } else {
                console.warn(`Could not create layer for: ${layerId}`);
              }
            } else {
              console.warn(`Dataset not found for: ${layerId}`);
            }
          });

          console.log(`Total layers loaded: ${map.getLayers().getLength()}`);
        } catch (error) {
          console.error("Error loading layers from catalog:", error);
        }
      }

      async function loadProjectGeometry() {
        return new Promise(async (resolve, reject) => {
          try {
            // Parse the WKT geometry for the main project geometry
            const wktFormat = new ol.format.WKT();
            const geometry = wktFormat.readGeometry(project.geometryWkt, {
              dataProjection: "EPSG:25832",
              featureProjection: "EPSG:25832",
            });

            const mitigationColor =
              mitigationMeasureMap[project.subsidyScheme.mitigationMeasureId]
                ?.color || projectNoVirkemiddelColor;
            // Create a vector layer for the project geometry
            const projectLayer = new ol.layer.Vector({
              source: new ol.source.Vector({
                features: [new ol.Feature(geometry)],
              }),
              zIndex: 1010,
              style: getProjectStyle(mitigationColor),
            });

            map.addLayer(projectLayer);

            if (!!project.snapshotGeometryWkt) {
              // Parse the WKT geometry for the snapshot geometry
              const snapshotGeometry = wktFormat.readGeometry(
                project.snapshotGeometryWkt,
                {
                  dataProjection: "EPSG:25832",
                  featureProjection: "EPSG:25832",
                }
              );

              // Create a vector layer for the snapshot geometry
              const snapshotLayer = new ol.layer.Vector({
                source: new ol.source.Vector({
                  features: [new ol.Feature(snapshotGeometry)],
                }),
                zIndex: 1000,
                style: getSnapshotProjectStyle(mitigationColor),
              });

              map.addLayer(snapshotLayer);
            }

            // Zoom to the extent of the project geometry
            const extent = geometry.getExtent();
            zoomMaptoExtent(map, extent);
            resolve(true);
          } catch (error) {
            console.error("Error loading project geometry:", error);
            reject(error);
          }
        });
      }

      function zoomMaptoExtent(map, extent) {
        map.getView().fit(extent, {
          minResolution: 0.2,
          padding: [
            mapZoomPaddingPx,
            mapZoomPaddingPx,
            mapZoomPaddingPx,
            mapZoomPaddingPx,
          ],
          duration: 0,
          nearest: true,
        });
      }
      // #endregion

      // #region Style Management

      const defaultStrokeWidth = 2;
      const whiteStrokeWidth = 6;
      const hoverOpacity = 0.5; // 0.5 default hover opacity
      const selectedOpacity = 0.2; // 0.2 default select opacity

      const whiteColor = [255, 255, 255, 1];
      const transparentFill = [0, 255, 255, 0];
      const defaultStrokeColor = [23, 94, 123, 1];
      const modifyPointColor = [40, 120, 118, 0.3];
      const projectNoVirkemiddelColor = [11, 45, 59, 1];
      const defaultFillColor = defaultStrokeColor.with(3, 0.05);

      function getProjectStyle(color) {
        const strokeNums =
          typeof color === "string" ? ol.color.fromString(color) : color;
        return [
          new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: strokeNums,
              width: 3,
            }),
            fill: new ol.style.Fill({
              color: strokeNums.with(3, 0.3),
            }),
            zIndex: 2,
          }),
          new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: whiteColor,
              width: 8,
            }),
            zIndex: 1,
          }),
        ];
      }

      function getSnapshotProjectStyle(strokeColor) {
        return [
          new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: strokeColor,
              width: 3,
              lineDash: [15, 10],
            }),
            fill: new ol.style.Fill({
              color: transparentFill,
            }),
            zIndex: 2,
          }),
          new ol.style.Style({
            stroke: new ol.style.Stroke({
              color: whiteColor,
              width: 8,
            }),
            zIndex: 1,
          }),
        ];
      }

      // #endregion
      async function readyForPDFFunc(timeoutMs = 30000) {
        return new Promise((resolve, reject) => {
          // Check if already ready
          if (readyForPDF) {
            resolve(true);
            return;
          }

          let timeoutId = null;
          let intervalId = null;
          let startTime = Date.now();

          // Cleanup function to prevent memory leaks
          const cleanup = () => {
            if (timeoutId) {
              clearTimeout(timeoutId);
              timeoutId = null;
            }
            if (intervalId) {
              clearInterval(intervalId);
              intervalId = null;
            }
          };

          // Set up timeout to prevent infinite waiting
          timeoutId = setTimeout(() => {
            cleanup();
            reject(new Error(`readyForPDF timeout after ${timeoutMs}ms`));
          }, timeoutMs);

          // Use setInterval instead of recursive setTimeout for better performance
          intervalId = setInterval(() => {
            if (readyForPDF) {
              cleanup();
              resolve(true);
            } else {
              // Additional safety check for elapsed time
              const elapsed = Date.now() - startTime;
              if (elapsed >= timeoutMs) {
                cleanup();
                reject(new Error(`readyForPDF timeout after ${elapsed}ms`));
              }
            }
          }, 100);
        });
      }

      // Create the map variable (will be initialized in Vue)
      let map;
      let readyForPDF = false;

      // Expose map and readyForPDFFunc to global scope for PDF generation
      window.readyForPDFFunc = readyForPDFFunc;

      // Initialize Vue app
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            project: project,
          };
        },
        methods: {
          formatDate(dateString) {
            if (!dateString) return "N/A";
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, "0");
            const month = String(date.getMonth() + 1).padStart(2, "0");
            const year = date.getFullYear();
            return `${day}.${month}.${year}`;
          },
        },
        computed: {
          mitigationMeasure() {
            return (
              mitigationMeasureMap[
                this.project.subsidyScheme.mitigationMeasureId
              ] || {}
            );
          },
        },
        mounted() {
          // Create the map instance using the Vue ref
          // Create a map view
          const view = new ol.View({
            center: [665690, 6237500],
            extent: extent,
            projection: "EPSG:25832", // Use EPSG:25832 for Danish data
            zoom: 1,
          });

          map = new ol.Map({
            target: this.$refs.mapContainer,
            layers: [],
            view: view,
          });

          // Expose map to global scope for PDF generation
          window.map = map;

          // Initialize the map after Vue is mounted to ensure DOM is ready
          loadLayersFromCatalog()
            .then(() => {
              console.log("Layers loaded successfully");
              loadProjectGeometry().then(() => {
                if (map && map.getView() && map.getLayers().getLength() > 0) {
                  // Wait for the next render complete event to ensure all layers are loaded
                  map.once("rendercomplete", () => {
                    readyForPDF = true;
                    console.log("Map is ready for PDF generation");
                  });

                  // Force a re-render to trigger the event
                  map.getView().changed();
                } else {
                  // If map isn't ready yet, wait a bit and try again
                  setTimeout(() => {
                    readyForPDF().then(resolve);
                  }, 100);
                }
              });
            })
            .catch((error) => {
              console.error("Error loading layers:", error);
            });
        },
      }).mount("#app");
    </script>
    <style type="text/css">
      #map {
        width: 100%;
        height: 300px;
      }

      .general-info {
        padding: 20px;
      }
    </style>
  </body>
</html>
